"use strict";var glance=(()=>{var Rt=Object.defineProperty;var se=Object.getOwnPropertyDescriptor;var ie=Object.getOwnPropertyNames;var ne=Object.prototype.hasOwnProperty;var he=(e,t)=>{for(var s in t)Rt(e,s,{get:t[s],enumerable:!0})},ae=(e,t,s,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ie(t))!ne.call(e,n)&&n!==s&&Rt(e,n,{get:()=>t[n],enumerable:!(i=se(t,n))||i.enumerable});return e};var re=e=>ae(Rt({},"__esModule",{value:!0}),e);var As={};he(As,{AttachmentType:()=>J,AttributeDataType:()=>m,BlendEquation:()=>ht,BlendFunc:()=>K,BufferUsage:()=>at,CullFace:()=>ct,DepthTest:()=>ot,DrawMode:()=>V,EPSILON:()=>D,FramebufferStack:()=>Ut,IndexDataType:()=>W,Mat3:()=>B,Mat4:()=>st,Profiler:()=>gt,Quat:()=>C,Rect:()=>ft,RenderbufferInternalFormat:()=>Tt,ShaderStage:()=>mt,TextureCompareFunc:()=>nt,TextureDataTarget:()=>q,TextureFilter:()=>$,TextureInternalFormat:()=>y,TextureSrcDataType:()=>R,TextureTarget:()=>g,TextureWrap:()=>tt,Vec2:()=>P,Vec3:()=>U,Vec4:()=>G,WebGLTimer:()=>At,clamp:()=>L,copyCanvasToTexture:()=>Es,countDigits:()=>Ee,createAttributeBuffer:()=>Bt,createBox:()=>es,createCanvasTexture:()=>fs,createCircularPlane:()=>ts,createDrawCall:()=>Re,createFramebuffer:()=>ye,createIndexBuffer:()=>Lt,createPlane:()=>Je,createProgram:()=>Ae,createRenderbuffer:()=>_e,createScreenQuad:()=>is,createShader:()=>It,createSphere:()=>ss,createTexture:()=>et,createTorusKnot:()=>ns,createVertexArrayObject:()=>Ft,degrees:()=>oe,draw:()=>Me,draw2DGrid:()=>ls,getBaricentricCoordinates:()=>os,getContext:()=>be,hex:()=>fe,interleaveArrays:()=>xs,isPowerOf2:()=>le,isSafeFloat:()=>Mt,loadCodeSnippet:()=>bs,loadCubemap:()=>qe,loadDataVolume:()=>Ke,loadObj:()=>rs,loadTexture:()=>We,mapRange:()=>xe,mulberry32:()=>Qe,nextEven:()=>de,openSimplex2SHeightmap:()=>Ze,radians:()=>ce,range:()=>ue,repeat:()=>Zt,resetContext:()=>me,slice:()=>ds,uniquifyVertices:()=>cs,updateFramebufferLayer:()=>we,updateTextureData:()=>ut});function z(e){console.log(e())}function I(e){console.warn(e())}function b(e){throw new Error(e())}function S(e,t){if(!e)throw new Error(t?t():"Assertion failed.")}var ys=async function(){}.constructor;function lt(e,t){if(e===t)return!0;if(e===null||t===null||e===void 0||t===void 0||typeof e!=typeof t||typeof e!="object")return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!lt(e[s],t[s]))return!1}else{let s=Object.keys(e);if(s.length!==Object.keys(t).length)return!1;for(let i of s)if(!lt(e[i],t[i]))return!1}return!0}function Y(e){if(typeof e!="object"||e===null)return e;let t,s,i=Object.prototype.toString.call(e);if(i==="[object Object]"){if(e.constructor!==Object&&typeof e.constructor=="function"){s=new e.constructor;for(t in e)e.hasOwnProperty(t)&&s[t]!==e[t]&&(s[t]=Y(e[t]))}else{s={};for(t in e)t==="__proto__"?Object.defineProperty(s,t,{value:Y(e[t]),configurable:!0,enumerable:!0,writable:!0}):s[t]=Y(e[t])}return s}if(i==="[object Array]"){for(t=e.length,s=Array(t);t--;)s[t]=Y(e[t]);return s}return i==="[object Set]"?(s=new Set,e.forEach(function(n){s.add(Y(n))}),s):i==="[object Map]"?(s=new Map,e.forEach(function(n,h){s.set(Y(h),Y(n))}),s):i==="[object Date]"?new Date(+e):i==="[object RegExp]"?(s=new RegExp(e.source,e.flags),s.lastIndex=e.lastIndex,s):i==="[object DataView]"?new e.constructor(Y(e.buffer)):i==="[object ArrayBuffer]"?e.slice(0):i.slice(-6)==="Array]"?new e.constructor(e):e}function rt(e){throw new Error(`Unexpected object: ${e}`)}var D=1e-7;function ce(e){return e*Math.PI/180}function oe(e){return e*180/Math.PI}function L(e,t,s){return Math.min(Math.max(e,t),s)}function*ue(e,t,s=1){e=Math.round(e),t===void 0?(t=e,e=0):t=Math.round(t),s=Math.max(1,Math.round(Math.abs(s)));let i=Math.sign(t-e)||1;for(;Math.sign(t-e)!==-i;)yield e,e+=s*i}function fe(e){return e.toString(16).padStart(2,"0")}function le(e){return Number.isInteger(e)&&(e&e-1)===0}function Ee(e){return e===0?1:Math.floor(Math.log10(Math.abs(e)))+1}function de(e){return Math.ceil(e/2)*2}function xe(e,t,s,i=0,n=1){return i+(e-t)/(s-t)*(n-i)}function Mt(e){return Math.abs(e)<=16777216}var mt;(function(e){e[e.VERTEX=35633]="VERTEX",e[e.FRAGMENT=35632]="FRAGMENT"})(mt||(mt={}));var J;(function(e){e[e.TEXTURE=1]="TEXTURE",e[e.RENDERBUFFER=2]="RENDERBUFFER"})(J||(J={}));var m;(function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV"})(m||(m={}));var W;(function(e){e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT"})(W||(W={}));var at;(function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"})(at||(at={}));var g;(function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(g||(g={}));var q;(function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(q||(q={}));var R;(function(e){e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.FLOAT=5126]="FLOAT"})(R||(R={}));var y;(function(e){e[e.R8=33321]="R8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.R8UI=33330]="R8UI",e[e.RG8=33323]="RG8",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.RG8UI=33336]="RG8UI",e[e.RGB8=32849]="RGB8",e[e.SRGB8=35905]="SRGB8",e[e.RGB565=36194]="RGB565",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGB16F=34843]="RGB16F",e[e.RGB32F=34837]="RGB32F",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA8=32856]="RGBA8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGBA4=32854]="RGBA4",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGBA16F=34842]="RGBA16F",e[e.RGBA32F=34836]="RGBA32F",e[e.RGBA8UI=36220]="RGBA8UI",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8"})(y||(y={}));var $;(function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})($||($={}));var tt;(function(e){e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(tt||(tt={}));var nt;(function(e){e[e.NONE=0]="NONE",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(nt||(nt={}));var Tt;(function(e){e[e.RGBA4=32854]="RGBA4",e[e.RGB565=36194]="RGB565",e[e.RGB5_A1=32855]="RGB5_A1",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.R8=33321]="R8",e[e.R8UI=33330]="R8UI",e[e.R8I=33329]="R8I",e[e.R16UI=33332]="R16UI",e[e.R16I=33331]="R16I",e[e.R32UI=33334]="R32UI",e[e.R32I=33333]="R32I",e[e.RG8=33323]="RG8",e[e.RG8UI=33336]="RG8UI",e[e.RG8I=33335]="RG8I",e[e.RG16UI=33338]="RG16UI",e[e.RG16I=33337]="RG16I",e[e.RG32UI=33340]="RG32UI",e[e.RG32I=33339]="RG32I",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGBA16I=36232]="RGBA16I",e[e.RGBA32I=36226]="RGBA32I",e[e.RGBA32UI=36208]="RGBA32UI",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F"})(Tt||(Tt={}));var ct;(function(e){e[e.NONE=0]="NONE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(ct||(ct={}));var ot;(function(e){e[e.NONE=0]="NONE",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(ot||(ot={}));var K;(function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(K||(K={}));var ht;(function(e){e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"})(ht||(ht={}));var V;(function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP"})(V||(V={}));function be(e,t={}){let s=null;typeof e=="string"?(s=document.querySelector(`#${e}`),s==null&&b(()=>`Could not find canvas element with id "${e}"`)):e instanceof HTMLCanvasElement?s=e:b(()=>`Invalid canvas element "${e}"`);let i=s.id??"unnamed canvas",n=s.getContext("webgl2",{alpha:t.alpha??!0,depth:t.depth??!0,stencil:t.stencil??!1,antialias:t.antialias??!1,premultipliedAlpha:t.premultipliedAlpha??!1,preserveDrawingBuffer:t.preserveDrawingBuffer??!0,powerPreference:t.powerPreference??"high-performance",desynchronized:t.desynchronized??!0});return n===null&&b(()=>`Could not acquire a WebGL2 context from canvas "${i}"`),n.getExtension("EXT_color_buffer_float")===null&&I(()=>"Extension 'EXT_color_buffer_float' is not supported."),n.getExtension("OES_texture_float_linear")===null&&I(()=>"Extension 'OES_texture_float_linear' is not supported."),n.getExtension("EXT_float_blend")===null&&I(()=>"Extension 'EXT_float_blend' is not supported."),n.getExtension("EXT_texture_filter_anisotropic")===null&&I(()=>"Extension 'EXT_texture_filter_anisotropic' is not supported."),n.__glance={generation:1,shaders:new Map,programs:new Map,buffers:new Array,vaos:new Array,textures:new Array,renderbuffers:new Array,framebuffers:new Array},n}function It(e,t,s,i){s!==e.VERTEX_SHADER&&s!==e.FRAGMENT_SHADER&&b(()=>`Invalid shader stage ${s} for shader "${t}"`);let n=s===e.VERTEX_SHADER?"vertex":"fragment";{let r=e.__glance.shaders.get(i);if(r){let o=r.object;return o.stage!==s&&b(()=>`Shader "${t}" already exists as a ${o.stage===e.VERTEX_SHADER?"vertex":"fragment"} shader.`),r.generation=e.__glance.generation,z(()=>`Reusing cached ${n} shader "${t}"`),o}}let h=e.createShader(s);if(h||b(()=>`Failed to create ${n} shader "${t}"`),e.shaderSource(h,i),e.compileShader(h),!e.getShaderParameter(h,e.COMPILE_STATUS)){let r=e.getShaderInfoLog(h);e.deleteShader(h),b(()=>`Failed to compile ${n} shader "${t}": ${r}`)}let a={glo:h,name:t,stage:s,source:i};return z(()=>`Created ${n} shader "${t}"`),e.__glance.shaders.set(i,{object:a,generation:e.__glance.generation}),a}function Ae(e,t,s,i,n){let h=`${typeof s=="string"?s:s.source}
${typeof i=="string"?i:i.source}`,a=e.__glance.programs.get(h);if(a)return a.generation=e.__glance.generation,n!==void 0&&Pt(e,a.object,n),z(()=>`Reusing cached program "${t}"`),a.object;let r=t.replace(/(-program|-shader)$/,"");typeof s=="string"?s=It(e,`${r}-vertex`,e.VERTEX_SHADER,s):(!e.isShader(s.glo)||s.stage!==e.VERTEX_SHADER)&&b(()=>`Invalid vertex shader for program "${t}"`),typeof i=="string"?i=It(e,`${r}-fragment`,e.FRAGMENT_SHADER,i):(!e.isShader(i.glo)||i.stage!==e.FRAGMENT_SHADER)&&b(()=>`Invalid fragment shader for program "${t}"`);let o=e.createProgram();o||b(()=>`Failed to create program "${t}"`),e.attachShader(o,s.glo),e.attachShader(o,i.glo),e.linkProgram(o);try{e.getProgramParameter(o,e.LINK_STATUS)||b(()=>`Failed to link shader program "${t}": ${e.getProgramInfoLog(o)}
Vertex Shader log: ${e.getShaderInfoLog(s.glo)}
Fragent Shader log: ${e.getShaderInfoLog(i.glo)}`);let c={name:t,vertex:s,fragment:i,glo:o,attributes:new Map,uniforms:new Map};return Te(e,c),Pt(e,c,n??{}),z(()=>`Created program "${t}"`),e.__glance.programs.set(h,{object:c,generation:e.__glance.generation}),c}catch(c){throw e.deleteProgram(o),c}}function Bt(e,t,s,i){i=i??at.STATIC_DRAW;let n=new Map,h,a=0;for(let[l,u]of Object.entries(s)){let E={type:u.type??m.FLOAT,height:u.height,width:u.width??1,normalized:u.normalized,divisor:u.divisor},x=E.height*E.width;x===0&&b(()=>`Invalid size ${x} for Attribute "${l}" of ABO "${t}"`);let A=u.data.length/x;A===0&&b(()=>`The data for Attribute "${l}" of ABO "${t}" must not be empty.`),A%1!==0&&b(()=>`The data length for Attribute "${l}" of ABO "${t}" must be a multiple of the number of scalars required per attribute. Data length is ${u.data.length}, attribute length is ${x}.`),pe(E.type)&&(E.height!==3&&E.height!==4&&b(()=>`Attribute "${l}" of ABO "${t}" must have a height of 3 or 4 when using packed integer data.`),E.width!==1&&b(()=>`Attribute "${l}" of ABO "${t}" must have a width of 1 when using packed integer data.`)),h===void 0?h=A:h!==A&&b(()=>`Attribute buffer "${t}" has inconsistent vertex counts`),n.set(l,E),a+=x*Et(E.type)}h===void 0&&b(()=>`Attribute Buffer "${t}" must have at least one attribute.`);let r=new ArrayBuffer(h*a),o=new DataView(r),c=new Map([[m.BYTE,o.setInt8.bind(o)],[m.UNSIGNED_BYTE,o.setUint8.bind(o)],[m.SHORT,o.setInt16.bind(o)],[m.UNSIGNED_SHORT,o.setUint16.bind(o)],[m.INT,o.setInt32.bind(o)],[m.UNSIGNED_INT,o.setUint32.bind(o)],[m.FLOAT,o.setFloat32.bind(o)],[m.HALF_FLOAT,(l,u)=>o.setUint16(l,ge(u),!0)]]),f=0;for(let[l,u]of n.entries()){let E=s[l].data,x=u.height*u.width,A=Et(u.type),_=x*A,w=a-_,M=f,T=c.get(u.type);if(T)for(let N=0;N<E.length;N++)S(M<r.byteLength,()=>`Attribute "${l}" of ABO "${t}" is out of bounds.`),T(M,E[N],!0),M+=A,(N+1)%x===0&&(M+=w);else{let N;switch(u.type){case m.INT_2_10_10_10_REV:{N=$e;break}case m.UNSIGNED_INT_2_10_10_10_REV:{N=Oe;break}default:b(()=>`Unsupported data type for attribute "${l}" of buffer "${t}"`)}if(u.height===3)for(let p=0;p<E.length;p+=3)o.setUint32(M,N(E[p],E[p+1],E[p+2],1),!1),M+=w;else for(let p=0;p<E.length;p+=4)o.setUint32(M,N(E[p],E[p+1],E[p+2],E[p+3]),!1),M+=w}f+=_}let d=e.createBuffer();d||b(()=>`Failed to create attribute buffer "${t}"`);try{return e.bindBuffer(e.ARRAY_BUFFER,d),e.bufferData(e.ARRAY_BUFFER,r,i),z(()=>`Created Attribute Buffer "${t}" with ${n.size} attributes for ${h} vertices and a size of ${r.byteLength} bytes.`),e.__glance.buffers.push(d),{glo:d,name:t,vertexCount:h,attributes:n,usage:i}}catch(l){throw e.deleteBuffer(d),l}finally{e.bindBuffer(e.ARRAY_BUFFER,null)}}function Lt(e,t,s,i={}){let n=i.drawMode??V.TRIANGLES;switch(S(s.length>0,()=>`Index buffer "${t}" must have at least one index.`),n){case V.TRIANGLES:S(s.length%3===0,()=>`Size of Index buffer "${t}" with draw mode 'TRIANGLES' must be a multiple of 3.`);break;case V.TRIANGLE_STRIP:S(s.length>=3,()=>`Size of Index buffer "${t}" draw mode 'TRIANGLE_STRIP' must be at least 3.`);break;case V.LINES:S(s.length%2===0,()=>`Size of Index buffer "${t}" with draw mode 'LINES' must be a multiple of 2.`);break;case V.LINE_STRIP:S(s.length>=2,()=>`Size of Index buffer "${t}" with draw mode 'LINE_STRIP' must be at least 2.`);break;case V.LINE_LOOP:S(s.length>=2,()=>`Size of Index buffer "${t}" with draw mode 'LINE_LOOP' must be at least 2.`);break;case V.POINTS:break;default:b(()=>`Index buffer "${t}" has invalid draw mode: ${n}.`)}let h=0;for(let f of s)(f<0||!Number.isSafeInteger(f))&&b(()=>`Index buffer "${t}" must contain only (safe, positive) integers.`),h=Math.max(h,f);let a;h<256?a=W.UNSIGNED_BYTE:h<65536?a=W.UNSIGNED_SHORT:h<4294967296?a=W.UNSIGNED_INT:b(()=>`Index ${h} does not fit in a 32-bit unsigned integer.`);let r;switch(a){case W.UNSIGNED_BYTE:r=new Uint8Array(s);break;case W.UNSIGNED_SHORT:r=new Uint16Array(s);break;case W.UNSIGNED_INT:r=new Uint32Array(s);break}let o=e.createBuffer();o||b(()=>`Failed to create index buffer "${t}"`);let c=i.usage??at.STATIC_DRAW;try{return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o),e.bufferData(e.ELEMENT_ARRAY_BUFFER,r,c),z(()=>`Created Index Buffer "${t}" with ${s.length} indices and a size of ${r.byteLength} bytes.`),e.__glance.buffers.push(o),{glo:o,name:t,type:a,size:s.length,usage:c,drawMode:n}}catch(f){throw e.deleteBuffer(o),f}finally{e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}}function Ft(e,t,s,i,n){let h=t.replace(/-vao$/,"");Array.isArray(s)&&(s=Lt(e,`${h}-ibo`,s)),Array.isArray(i)?i.length===0&&b(()=>`Need at least one Attribute Buffer for VAO "${t}"`):(i.hasOwnProperty("glo")||(i=Bt(e,`${h}-abo`,i)),i=[i]);let a=e.createVertexArray();a||b(()=>`Failed to create VAO "${t}"`);let r=new Map;try{e.bindVertexArray(a),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s.glo);let o=e.getParameter(e.MAX_VERTEX_ATTRIBS);for(let c of i){e.bindBuffer(e.ARRAY_BUFFER,c.glo);let f=Se(c),d=0;for(let[l,u]of c.attributes){let E=d;d+=Ct(u);let x=n.attributes.get(l);if(!x)continue;if(r.has(x.location)){let _=r.get(x.location).buffer;console.warn(`Ignoring attribute "${l}" in buffer "${c.name}" as the attribute is already bound to buffer "${_.name}".`);continue}r.set(x.location,{buffer:c,name:l});let A=u.height*Et(u.type);for(let _=0;_<u.width;++_){let w=x.location+_;w>=o&&b(()=>`Attribute "${l}" of VAO "${t}" cannot be bound to location ${w}, because it would exceed the maximum number of vertex attributes (${o}).`);let M=E+_*A;e.enableVertexAttribArray(w),Ne(u.type)?e.vertexAttribIPointer(w,u.height,u.type,f,M):e.vertexAttribPointer(w,u.height,u.type,u.normalized||!1,f,M),e.vertexAttribDivisor(w,u.divisor||0)}}}return z(()=>`Created Vertex Array Object "${t}" with ${r.size} attributes.`),e.__glance.vaos.push(a),{glo:a,name:t,ibo:s,attributes:r}}catch(o){throw e.deleteVertexArray(a),o}finally{e.bindVertexArray(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}}function et(e,t,s,i,n={}){let h=n.target??g.TEXTURE_2D;n.depth!==void 0&&(!Number.isSafeInteger(n.depth)||n.depth<1)&&b(()=>`Invalid depth ${n.depth} for texture "${t}"`);let a=n.depth??1,r=Be(h);h==g.TEXTURE_2D||h==g.TEXTURE_CUBE_MAP?(a!==1&&I(()=>`Ignoring given depth ${a} of ${r} texture "${t}".`),(s<1||i<1||!Number.isSafeInteger(s)||!Number.isSafeInteger(i))&&b(()=>`Invalid texture dimensions: ${s}x${i} of ${r} texture "${t}".`)):(s<1||i<1||a<1||!Number.isSafeInteger(s)||!Number.isSafeInteger(i)||!Number.isSafeInteger(a))&&b(()=>`Invalid texture dimensions: ${s}x${i}x${a} of ${r} texture "${t}".`);let o=Math.floor(Math.log2(Math.max(s,i,a)))+1;n.levels!==void 0&&((n.levels<1||!Number.isSafeInteger(n.levels))&&b(()=>`Invalid number of levels for ${r} texture "${t}": ${n.levels}.`),n.levels>o&&(I(()=>`Ignoring given number of levels for ${r} texture "${t}" because ${n.levels} is larger than the maximum possible number of levels ${o}.`),n.levels=o));let c=n.levels??o,f=n.internalFormat??y.RGBA8;n.compareFunc&&!ke(f)&&(I(()=>`Ignoring given comparison function for ${r} texture "${t}" because it is not a depth texture.`),n.compareFunc=nt.NONE);let d=n.compareFunc??nt.NONE,l=e.createTexture();l===null&&b(()=>`Failed to create WebGL texture for ${r} texture "${t}"`);try{let u=n.wipTextureUnit??jt(e,n.wipTextureUnit);if(e.activeTexture(e.TEXTURE0+u),e.bindTexture(h,l),a===1){if(e.texStorage2D(h,c,f,s,i),f===y.RGBA8){let M=new Uint8Array(s*i*4);if(h===g.TEXTURE_2D)e.texSubImage2D(h,0,0,0,s,i,e.RGBA,e.UNSIGNED_BYTE,M);else for(let T=0;T<6;++T)e.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+T,0,0,0,s,i,e.RGBA,e.UNSIGNED_BYTE,M);c>1&&e.generateMipmap(h)}d!==nt.NONE&&(e.texParameteri(h,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(h,e.TEXTURE_COMPARE_FUNC,d))}else e.texStorage3D(h,c,f,s,i,a);let E,x;n.filter===void 0?(c>1?E=$.LINEAR_MIPMAP_LINEAR:E=$.LINEAR,x=$.LINEAR):Array.isArray(n.filter)?(E=n.filter[0],x=n.filter[1]):(E=n.filter,x=n.filter),c===1&&([$.NEAREST,$.LINEAR].includes(E)||(I(()=>`Ignoring given minification filter for ${r} texture "${t}" because it has only one level.`),[$.NEAREST_MIPMAP_NEAREST,$.NEAREST_MIPMAP_LINEAR].includes(E)?E=$.NEAREST:E=$.LINEAR)),[$.NEAREST,$.LINEAR].includes(x)||(I(()=>`Ignoring given magnification filter for ${r} texture "${t}".`),[$.NEAREST_MIPMAP_NEAREST,$.NEAREST_MIPMAP_LINEAR].includes(x)?x=$.NEAREST:x=$.LINEAR),He(f)&&(![$.NEAREST,$.NEAREST_MIPMAP_NEAREST].includes(E)||x!==$.NEAREST)&&e.getExtension("OES_texture_float_linear")===null&&(I(()=>"Linear filtering for floating point textures is not supported on this system."),E=$.NEAREST,x=$.NEAREST),e.texParameteri(h,e.TEXTURE_MIN_FILTER,E),e.texParameteri(h,e.TEXTURE_MAG_FILTER,x);let A,_,w;if(n.wrap===void 0?(A=tt.CLAMP_TO_EDGE,_=tt.CLAMP_TO_EDGE,w=tt.CLAMP_TO_EDGE):Array.isArray(n.wrap)?(A=n.wrap[0],_=n.wrap[1],w=n.wrap[2]??tt.CLAMP_TO_EDGE,h===g.TEXTURE_2D&&n.wrap.length>2&&I(()=>`Ignoring given wrap R mode for ${r} texture "${t}" because it has only two dimensions.`)):(A=n.wrap,_=n.wrap,w=n.wrap),e.texParameteri(h,e.TEXTURE_WRAP_S,A),e.texParameteri(h,e.TEXTURE_WRAP_T,_),h!==g.TEXTURE_2D&&e.texParameteri(h,e.TEXTURE_WRAP_R,w),n.useAnisotropy||n.useAnisotropy===void 0&&c>1){let M=e.getExtension("EXT_texture_filter_anisotropic");M?e.texParameterf(h,M.TEXTURE_MAX_ANISOTROPY_EXT,e.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)):n.useAnisotropy&&I(()=>"Anisotropic filtering is not supported.")}return z(()=>`Created ${r} texture "${t}" with dimensions ${s}x${i}x${a} and ${c} levels.`),e.__glance.textures.push(l),{glo:l,name:t,target:h,width:s,height:i,depth:a,levels:c,internalFormat:f,compareFunc:d,attachmentType:J.TEXTURE}}catch(u){throw e.deleteTexture(l),u.message=`Failed to create ${r} texture "${t}": ${u.message}`,u}finally{e.bindTexture(h,null),e.activeTexture(e.TEXTURE0)}}function ut(e,t,s,i={}){i.dataTarget===void 0?t.target===g.TEXTURE_CUBE_MAP&&b(()=>`You need to specify an explicit target when updating a face of cube map texture "${t.name}".`):t.target===g.TEXTURE_CUBE_MAP&&(i.dataTarget>=q.TEXTURE_CUBE_MAP_POSITIVE_X&&i.dataTarget<=q.TEXTURE_CUBE_MAP_NEGATIVE_Z||b(()=>`Invalid data target '${i.dataTarget}' for cube map texture: "${t.name}".`));let n=i.dataTarget??t.target;i.level!==void 0&&(i.level<0||!Number.isSafeInteger(i.level))&&b(()=>`Invalid mipmap level: ${i.level}.`);let h=i.level??0,a=jt(e,i.wipTextureUnit);i.srcDataType===void 0?ArrayBuffer.isView(s)?i.srcDataType=Le(s):i.srcDataType=R.UNSIGNED_BYTE:ArrayBuffer.isView(s)?Fe(s,i.srcDataType):i.srcDataType!==R.UNSIGNED_BYTE&&b(()=>"When defining a texture with a 'TexImageSource', the source data type must be 'UNSIGNED_BYTE'");let r=i.srcDataType;Ce(t.internalFormat,r)||b(()=>`Invalid combination of internal format ${t.internalFormat} and source data type ${r}. See https://registry.khronos.org/webgl/specs/latest/2.0/#TEXTURE_TYPES_FORMATS_FROM_DOM_ELEMENTS_TABLE`);let o=Xe(e,t.internalFormat),c=i.flipY??t.target===g.TEXTURE_2D,f=i.createMipMaps??t.levels>1;try{e.activeTexture(e.TEXTURE0+a),e.bindTexture(t.target,t.glo),c&&e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),t.depth>1?e.texSubImage3D(n,h,0,0,0,t.width,t.height,t.depth,o,r,s):e.texSubImage2D(n,h,0,0,t.width,t.height,o,r,s),f&&e.generateMipmap(t.target)}catch(d){throw d.message=`Failed to define texture "${t.name}": ${d.message}`,d}finally{e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)}}function _e(e,t,s,i,n){(s<1||i<1||!Number.isSafeInteger(s)||!Number.isSafeInteger(i))&&b(()=>`Invalid renderbuffer dimensions: ${s}x${i} of renderbuffer "${t}".`),n===void 0&&b(()=>`Missing internal format for renderbuffer "${t}".`);let h=e.getParameter(e.MAX_RENDERBUFFER_SIZE);(s>h||i>h)&&b(()=>`Renderbuffer "${t}" exceeds the maximum renderbuffer size of ${h}.`);let a=e.createRenderbuffer();a===null&&b(()=>`Failed to create a new WebGL renderbuffer object for "${t}".`);try{return e.bindRenderbuffer(e.RENDERBUFFER,a),e.renderbufferStorage(e.RENDERBUFFER,n,s,i),z(()=>`Created Renderbuffer "${t}" with dimensions ${s}x${i} and internal format ${n}.`),e.__glance.renderbuffers.push(a),{glo:a,name:t,width:s,height:i,internalFormat:n,attachmentType:J.RENDERBUFFER}}catch(r){throw e.deleteRenderbuffer(a),r}finally{e.bindRenderbuffer(e.RENDERBUFFER,null)}}function ye(e,t,s=null,i=null,n=null){let h=u=>Object.hasOwn(u,"attachmentType"),a=(Array.isArray(s)?s:s===null?[]:[s]).map(u=>h(u)?{attachment:u}:u),r=i===null?null:h(i)?{attachment:i}:i,o=n===null?null:h(n)?{attachment:n}:n,c=e.getParameter(e.MAX_COLOR_ATTACHMENTS);a.length>c&&b(()=>`Framebuffer "${t}" has ${a.length} color attachments, but the maximum is ${c}.`);let f;for(let u=0;u<a.length;++u){let E=a[u].attachment;f===void 0?f=[E.width,E.height]:(E.width!==f[0]||E.height!==f[1])&&b(()=>`Framebuffer "${t}" has color attachments with different dimensions.`)}if(r!==null){let u=r.attachment;f===void 0?f=[u.width,u.height]:(u.width!==f[0]||u.height!==f[1])&&b(()=>`Framebuffer "${t}" has color/depth attachments with different dimensions.`)}let d=e.createFramebuffer();d===null&&b(()=>`Failed to create a new WebGL framebuffer object for "${t}".`);function l(u,E){let x=E===e.DEPTH_ATTACHMENT?"depth":`color[${E-e.COLOR_ATTACHMENT0}]`;if(u.attachment.attachmentType===J.TEXTURE){let A=u.attachment;if(A.target===g.TEXTURE_2D)(u.target??q.TEXTURE_2D)!==q.TEXTURE_2D&&I(()=>`Ignoring the target "${u.target}" for ${x} attachment of framebuffer "${t}", using 'gl.TEXTURE_2D' instead.`),e.framebufferTexture2D(e.FRAMEBUFFER,E,e.TEXTURE_2D,A.glo,u.level??0);else if(A.target===g.TEXTURE_CUBE_MAP)u.target===void 0&&b(()=>`Missing target for cubemap ${x} attachment of framebuffer "${t}".`),u.target>=q.TEXTURE_CUBE_MAP_POSITIVE_X&&u.target<=q.TEXTURE_CUBE_MAP_NEGATIVE_Z||b(()=>`Invalid data target for cube map texture: ${u.target}.`),e.framebufferTexture2D(e.FRAMEBUFFER,E,u.target,A.glo,u.level??0);else{if(u.target??A.target!==A.target){let _=A.target===g.TEXTURE_2D_ARRAY?"gl.TEXTURE_2D_ARRAY":"gl.TEXTURE_3D";I(()=>`Ignoring the target "${u.target}" for ${x} attachment of framebuffer "${t}", using ${_} instead.`)}if(u.layer===void 0){let _=A.target===g.TEXTURE_2D_ARRAY?"2D array":"3D";I(()=>`Missing layer for ${x} attachment (which is a ${_} texture) of framebuffer "${t}", using layer 0 by default.`)}e.framebufferTextureLayer(e.FRAMEBUFFER,E,A.glo,u.level??0,u.layer??0)}}else{let A=u.attachment;u.level!==void 0&&I(()=>`Ignoring given level ${u.level} for renderbuffer ${x} attachment of framebuffer "${t}".`),u.target!==void 0&&I(()=>`Ignoring given target ${u.target} for renderbuffer ${x} attachment of framebuffer "${t}".`),e.framebufferRenderbuffer(e.FRAMEBUFFER,E,e.RENDERBUFFER,A.glo)}}try{if(e.bindFramebuffer(e.FRAMEBUFFER,d),a.length===0)e.drawBuffers([e.NONE]),e.readBuffer(e.NONE);else{let E=[];for(let x=0;x<a.length;++x){let A=e.COLOR_ATTACHMENT0+x;l(a[x],A),E.push(A)}e.drawBuffers(E)}r!==null&&l(r,e.DEPTH_ATTACHMENT),o!==null&&b(()=>"Stencil attachments are not supported yet.");let u=e.checkFramebufferStatus(e.FRAMEBUFFER);return u!==e.FRAMEBUFFER_COMPLETE&&b(()=>{switch(u){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return`Incomplete framebuffer '${t}'! One or more framebuffer attachment points are incomplete.`;case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return`Incomplete framebuffer '${t}'! One or more of the framebuffer attachment's dimensions are not the same.`;case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return`Incomplete framebuffer '${t}'! No images are attached to the framebuffer.`;case e.FRAMEBUFFER_UNSUPPORTED:return`Incomplete framebuffer '${t}'! The combination of internal formats of the attached images violates an implementation-dependent set of restrictions.`;case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return`Incomplete framebuffer '${t}'! The value of GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES is not the same for all attached textures.`;default:return`Incomplete framebuffer '${t}'! Unknown error code ${u}.`}}),r!==null?o!==null?z(()=>`Created Framebuffer "${t}" with ${a.length} color attachments, and a depth- and stencil attachment.`):z(()=>`Created Framebuffer "${t}" with ${a.length} color attachments and a depth attachment.`):o!==null?z(()=>`Created Framebuffer "${t}" with ${a.length} color attachments and a stencil attachment.`):z(()=>`Created Framebuffer "${t}" with ${a.length} color attachments.`),e.__glance.framebuffers.push(d),{glo:d,name:t,color:a,depth:r,stencil:o}}catch(u){throw e.deleteFramebuffer(d),u.message=`Failed to define framebuffer "${t}": ${u.message}`,u}finally{e.bindFramebuffer(e.FRAMEBUFFER,null)}}function we(e,t,s,i,n=0){let h,a;switch(s){case e.DEPTH_ATTACHMENT:h=t.depth??b(()=>`Framebuffer "${t.name}" has no depth attachment.`),a="depth";break;case e.STENCIL_ATTACHMENT:h=t.stencil??b(()=>`Framebuffer "${t.name}" has no stencil attachment.`),a="stencil";break;default:h=t.color[s-e.COLOR_ATTACHMENT0]??b(()=>`Framebuffer "${t.name}" has no color attachment at location ${s}.`),a=`color[${s-e.COLOR_ATTACHMENT0}]`}if(h.layer===i&&h.level===(n??h.level))return;h.attachment.attachmentType!==J.TEXTURE&&b(()=>`Framebuffer "${t.name}" has no texture as its ${a} attachment, but a renderbuffer.`);let r=h.attachment;if(r.target!==g.TEXTURE_2D_ARRAY&&r.target!==g.TEXTURE_3D){let c=r.target===g.TEXTURE_2D?"2D":"cubemap";b(()=>`Framebuffer "${t.name}" has no 3D or 2D array texture as its ${a} attachment, but a ${c} texture.`)}(i<0||i>=r.depth)&&b(()=>`Invalid layer ${i} for ${a} attachment of framebuffer "${t.name}", which has a depth of ${r.depth}.`);let o=e.getParameter(e.FRAMEBUFFER_BINDING);try{e.bindFramebuffer(e.FRAMEBUFFER,t.glo),e.framebufferTextureLayer(e.FRAMEBUFFER,s,r.glo,n??h.level??0,i)}finally{e.bindFramebuffer(e.FRAMEBUFFER,o)}}function Re(e,t,s,i,n={}){Object.hasOwn(s,"glo")||(s=Ft(e,`${t}-vao`,s.ibo,s.attributes,i)),s=s,n.indexCount!==void 0&&n.indexCount<=0&&b(()=>`Invalid index count: ${n.indexCount}.`),n.indexOffset!==void 0&&(n.indexOffset<0&&b(()=>`Invalid index offset: ${n.indexOffset}.`),n.indexOffset=Math.ceil(n.indexOffset));let h=n.indexCount??s.ibo.size,a=n.indexOffset??0;a+h>s.ibo.size&&b(()=>`Index offset ${a} and count ${h} exceed the size of the index buffer (${s.ibo.size}).`),n.instances!==void 0&&(n.instances<=0&&b(()=>`Instance count cannot be <= 0, is: ${n.instances}.`),Number.isSafeInteger(n.instances)||I(()=>`Instance count is not an integer, is: ${n.instances}.`),n.instances=Math.ceil(n.instances));for(let[r,o]of i.attributes.entries()){let c=s.attributes.get(o.location);c===void 0&&b(()=>`VAO "${s.name}" does not provide an attribute for "${r}" (at location ${o.location}) of shader program "${i.name}"!`);let f=c.buffer.attributes.get(c.name);f===void 0&&b(()=>`Missing attribute "${c.name}" in VBO "${c.buffer.name}"!`),Ie(f,o.type)||b(()=>{let d=Ue(f);return`Attribute "${c.name}" in VBO "${c.buffer.name}" has type '${d}' but shader program "${i.name}" expects type '${o.type} at location ${o.location}'!`}),r!=c.name&&I(()=>`Attribute "${r}" of shader program "${i.name}" at location ${o.location} is bound to attribute "${c.name}" in VBO "${c.buffer.name}"!`)}n.uniforms===void 0&&(n.uniforms={}),n.textures===void 0&&(n.textures={});for(let[r,o]of Object.entries(n.uniforms)){let c=i.uniforms.get(r);if(c===void 0){I(()=>`Uniform "${r}" of Draw Call "${t}" not found in shader program "${i.name}"!`);continue}dt(c.type)&&typeof o!="number"&&(o?.attachmentType!==J.TEXTURE&&b(()=>`Uniform "${r}" is not a texture or a number.`),n.textures[r]=o,delete n.uniforms[r])}for(let r of Object.keys(n.textures??{}))i.uniforms.has(r)||I(()=>`Sampler Uniform "${r}" of Draw Call "${t}" not found in shader program "${i.name}"!`);return{name:t,vao:s,program:i,indexCount:h,indexOffset:a,drawMode:n.drawModeOverride??s.ibo.drawMode,instances:n.instances??1,uniform:n.uniforms,textures:n.textures,cullFace:n.cullFace,depthTest:n.depthTest,blendFunc:n.blendFunc,blendEquation:n.blendEquation,updateDepthBuffer:n.updateDepthBuffer}}function Me(e,t){let s=t.vao,i=t.program,n=!0,h=!0;try{e.bindVertexArray(s.glo),e.useProgram(i.glo),t.cullFace!==void 0&&(t.cullFace===ct.NONE?e.disable(e.CULL_FACE):(e.enable(e.CULL_FACE),e.cullFace(t.cullFace))),t.depthTest!==void 0&&(t.depthTest===ot.NONE?e.disable(e.DEPTH_TEST):(e.enable(e.DEPTH_TEST),e.depthFunc(t.depthTest))),t.blendFunc!==void 0&&(t.blendFunc.length===2?(t.blendFunc[0]!==K.ONE||t.blendFunc[1]!==K.ZERO)&&(e.enable(e.BLEND),e.blendFunc(t.blendFunc[0],t.blendFunc[1]),n=!1):t.blendFunc.length===4?(t.blendFunc[0]!==K.ONE||t.blendFunc[1]!==K.ZERO&&t.blendFunc[2]!==K.ONE||t.blendFunc[3]!==K.ZERO)&&(e.enable(e.BLEND),e.blendFuncSeparate(t.blendFunc[0],t.blendFunc[1],t.blendFunc[2],t.blendFunc[3]),n=!1):b(()=>`Invalid blend function array length: ${t.blendFunc.length}.`)),t.blendEquation!==void 0&&(Array.isArray(t.blendEquation)?(t.blendEquation[0]!==ht.FUNC_ADD||t.blendEquation[1]!==ht.FUNC_ADD)&&(n&&e.enable(e.BLEND),e.blendEquationSeparate(t.blendEquation[0],t.blendEquation[1]),h=!1):t.blendEquation!==ht.FUNC_ADD&&(n&&e.enable(e.BLEND),e.blendEquation(t.blendEquation),h=!1)),t.updateDepthBuffer!==void 0&&e.depthMask(t.updateDepthBuffer);for(let[r,o]of Object.entries(t.uniform)){let c=i.uniforms.get(r);c||b(()=>`Uniform "${r}" not found in program "${i.name}"`),lt(c.value,o)||(c.value=Y(o),Vt(e,c,r))}{let r=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),o=new Map;for(let[c,f]of Object.entries(t.textures)){let d=i.uniforms.get(c);d||b(()=>`Sampler Uniform "${c}" not found in program "${i.name}"`),dt(d.type)||b(()=>`Uniform "${c}" in program "${i.name}" is not a sampler.`);let l=d.value;(l===void 0||typeof l!="number"||!Number.isSafeInteger(l))&&b(()=>`Value of Uniform "${c}" in program "${i.name}" is not a texture unit.`),(l<0||l>=r)&&b(()=>`Invalid texture unit ${l} for uniform "${c}" in program "${i.name}".`);let u=o.get(l)||{};switch(e.activeTexture(e.TEXTURE0+l),f.target){case g.TEXTURE_2D:{u.texture_2d!==void 0&&b(()=>`Texture unit ${l} is already used by another 2D texture.`),e.bindTexture(e.TEXTURE_2D,f.glo),u.texture_2d=f;break}case g.TEXTURE_3D:{u.texture_3d!==void 0&&b(()=>`Texture unit ${l} is already used by another 3D texture.`),e.bindTexture(e.TEXTURE_3D,f.glo),u.texture_3d=f;break}case g.TEXTURE_CUBE_MAP:{u.texture_cube!==void 0&&b(()=>`Texture unit ${l} is already used by another cube map texture.`),e.bindTexture(e.TEXTURE_CUBE_MAP,f.glo),u.texture_cube=f;break}case g.TEXTURE_2D_ARRAY:{u.texture_2d_array!==void 0&&b(()=>`Texture unit ${l} is already used by another 2D array texture.`),e.bindTexture(e.TEXTURE_2D_ARRAY,f.glo),u.texture_2d_array=f;break}default:rt(f.target)}o.set(l,u)}}let a=t.instances??1;(isNaN(a)||!isFinite(a)||a<1)&&b(()=>`Invalid instance count: ${a}.`),a=Math.ceil(a),a==1?e.drawElements(t.drawMode,t.indexCount,t.vao.ibo.type,t.indexOffset):e.drawElementsInstanced(t.drawMode,t.indexCount,t.vao.ibo.type,t.indexOffset,a)}finally{Object.keys(t.textures).length>0&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_3D,null),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)),t.updateDepthBuffer!==void 0&&e.depthMask(!0),(!n||!h)&&(e.disable(e.BLEND),n||e.blendFunc(e.ONE,e.ZERO),h||e.blendEquation(e.FUNC_ADD)),t.depthTest!==void 0&&(e.depthFunc(e.ALWAYS),e.disable(e.DEPTH_TEST)),t.cullFace!==void 0&&(e.cullFace(e.BACK),e.disable(e.CULL_FACE)),e.useProgram(null),e.bindVertexArray(null)}}function me(e,t=0){let s=!1,i=e.__glance.generation-t,n=(u,E)=>{let x=0;for(let[A,_]of u.entries())_.generation<=i&&(E(_.object),u.delete(A),x++,s=!0);return x},h=(u,E)=>{let x=u.length;for(let A=0;A<x;++A)E(u[A]),s=!0;return u.length=0,x},a=n(e.__glance.shaders,u=>e.deleteShader(u.glo)),r=n(e.__glance.programs,u=>e.deleteProgram(u.glo)),o=h(e.__glance.buffers,u=>e.deleteBuffer(u)),c=h(e.__glance.vaos,u=>e.deleteVertexArray(u)),f=h(e.__glance.textures,u=>e.deleteTexture(u)),d=h(e.__glance.renderbuffers,u=>e.deleteRenderbuffer(u)),l=h(e.__glance.framebuffers,u=>e.deleteFramebuffer(u));if(s){let u=`Cleaned up WebGL resources:
`;a>0&&(u+=` - ${a} shader${a>1?"s":""}
`),r>0&&(u+=` - ${r} program${r>1?"s":""}
`),o>0&&(u+=` - ${o} buffer${o>1?"s":""}
`),c>0&&(u+=` - ${c} VAO${c>1?"s":""}
`),f>0&&(u+=` - ${f} texture${f>1?"s":""}
`),d>0&&(u+=` - ${d} renderbuffer${d>1?"s":""}
`),l>0&&(u+=` - ${l} framebuffer${l>1?"s":""}
`),z(()=>u.slice(0,-1))}e.__glance.generation+=1,Ve(e)}function Te(e,t){let s=/^\s*(?:layout\s*\(location\s*=\s*(?<location>\d+)\)\s*)?in\s+(?:(?<precision>lowp|mediump|highp)\s+)?(?<type>\w+)\s+(?<name>\w+)\s*;/gm;if(t.attributes.size>0){I(()=>`Attributes of shader program "${t.name}" are already defined.`);return}let i;for(;(i=s.exec(t.vertex.source))!==null;){let{name:n,type:h,location:a,precision:r}=i.groups,o=e.getAttribLocation(t.glo,n);o<0||(a!==void 0&&o!==parseInt(a)&&I(()=>`Vertex shader of shader program "${n}" specifies the location of attribute "${n}" to be ${a}, but it was found at ${o}.`),(n.startsWith("webgl_")||n.startsWith("_webgl_"))&&b(()=>`Attribute name "${n}" is reserved by WebGL.`),t.attributes.set(n,{type:h,location:o,precision:r}))}}function Ne(e){switch(e){case m.BYTE:case m.UNSIGNED_BYTE:case m.SHORT:case m.UNSIGNED_SHORT:case m.INT:case m.UNSIGNED_INT:return!0;default:return!1}}function pe(e){switch(e){case m.INT_2_10_10_10_REV:case m.UNSIGNED_INT_2_10_10_10_REV:return!0;default:return!1}}function Et(e){switch(e){case m.BYTE:case m.UNSIGNED_BYTE:return 1;case m.SHORT:case m.UNSIGNED_SHORT:case m.HALF_FLOAT:return 2;case m.INT:case m.UNSIGNED_INT:case m.FLOAT:case m.INT_2_10_10_10_REV:case m.UNSIGNED_INT_2_10_10_10_REV:return 4;default:rt(e)}}function Ct(e){return Et(e.type)*e.height*e.width}function Se(e){let t=0;for(let s of e.attributes.values())t+=Ct(s);return t}function Ie(e,t){switch(e.type){case m.BYTE:case m.UNSIGNED_BYTE:case m.SHORT:case m.UNSIGNED_SHORT:case m.INT:case m.UNSIGNED_INT:switch(t){case"int":case"uint":return e.height===1&&e.width===1;case"ivec2":case"uvec2":return e.height===2&&e.width===1;case"ivec3":case"uvec3":return e.height===3&&e.width===1;case"ivec4":case"uvec4":return e.height===4&&e.width===1;default:return!1}case m.INT_2_10_10_10_REV:return t==="int";case m.UNSIGNED_INT_2_10_10_10_REV:return t==="uint";case m.FLOAT:case m.HALF_FLOAT:switch(t){case"float":return e.height===1&&e.width===1;case"vec2":return e.height===2&&e.width===1;case"vec3":return e.height===3&&e.width===1;case"vec4":return e.height===4&&e.width===1;case"mat2":case"mat2x2":return e.height===2&&e.width===2;case"mat2x3":return e.height===3&&e.width===2;case"mat2x4":return e.height===4&&e.width===2;case"mat3x2":return e.height===2&&e.width===3;case"mat3":case"mat3x3":return e.height===3&&e.width===3;case"mat3x4":return e.height===4&&e.width===3;case"mat4x2":return e.height===2&&e.width===4;case"mat4x3":return e.height===3&&e.width===4;case"mat4":case"mat4x4":return e.height===4&&e.width===4;default:return!1}default:rt(e.type)}}function Ue(e){switch(e.type){case m.BYTE:case m.SHORT:case m.INT:switch(e.width){case 1:switch(e.height){case 1:return"int";case 2:return"ivec2";case 3:return"ivec3";case 4:return"ivec4"}}break;case m.INT_2_10_10_10_REV:return"int";case m.UNSIGNED_INT_2_10_10_10_REV:return"uint";case m.UNSIGNED_BYTE:case m.UNSIGNED_SHORT:case m.UNSIGNED_INT:switch(e.width){case 1:switch(e.height){case 1:return"uint";case 2:return"uvec2";case 3:return"uvec3";case 4:return"uvec4"}}break;case m.FLOAT:case m.HALF_FLOAT:switch(e.width){case 1:switch(e.height){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}break;case 2:switch(e.height){case 2:return"mat2";case 3:return"mat2x3";case 4:return"mat2x4"}break;case 3:switch(e.height){case 2:return"mat3x2";case 3:return"mat3";case 4:return"mat3x4"}break;case 4:switch(e.height){case 2:return"mat4x2";case 3:return"mat4x3";case 4:return"mat4"}break}}b(()=>`Invalid attribute type: ${e.type} with a size of ${e.height} and a width of ${e.width}.`)}function ge(e){let t=new Float32Array(1),s=new Uint16Array(t.buffer);t[0]=e;let i=s[1]<<16|s[0],n=i>>31<<15,h=(i>>23&255)-127+15,a=i&8388607;return h<0?(h=0,a=(a|8388608)>>1-h):h>31&&(h=31,a=0),n|h<<10|a>>13}function $e(e,t,s,i){return L(Math.round(i),0,3)<<30|L(Math.round(s),0,1023)<<20|L(Math.round(t),0,1023)<<10|L(Math.round(e),0,1023)}function Oe(e,t,s,i){return Math.sign(i)<<31|L(Math.round(Math.abs(i)),0,1)<<30|Math.sign(s)<<29|L(Math.round(Math.abs(s)),0,511)<<20|Math.sign(t)<<19|L(Math.round(Math.abs(t)),0,511)<<10|Math.sign(e)<<9|L(Math.round(Math.abs(e)),0,511)}function Pt(e,t,s){let i=/^\s*uniform\s+(?<precision>lowp|mediump|highp)?\s*(?<type>\w+)\s+(?<name>\w+)(?:\s*\[\s*(?<sizeString>\d+)\s*\])?\s*;/gm;t.uniforms.clear();let n=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),h=[],a=new Set,r;for(let o of[t.vertex.source,t.fragment.source])for(;(r=i.exec(o))!==null;){let{name:c,type:f,precision:d,sizeString:l}=r.groups;if(t.uniforms.has(c))continue;let u=e.getUniformLocation(t.glo,c);if(!u)continue;let E=l?parseInt(l):1,x=s[c];if(x===void 0){if(dt(f)){h.push([c,{type:f,location:u,size:E,value:x,precision:d}]);continue}x=ze(f,E)}else dt(f)&&((typeof x!="number"||!Number.isSafeInteger(x)||x<0||x>=n)&&b(()=>`Invalid texture unit id: ${x}. Valid range is [0, ${n}).`),a.add(x));t.uniforms.set(c,{type:f,location:u,size:E,value:x,precision:d})}for(let[o,c]of h){let f=0;for(;a.has(f);)f++,f>=n&&b(()=>`No more texture units available for sampler "${o}".`);a.add(f),c.value=f,z(()=>`Auto-assigning texture sampler "${o}" to texture unit ${f}.`),t.uniforms.set(o,c)}try{e.useProgram(t.glo);for(let[o,c]of t.uniforms.entries())Vt(e,c,o)}finally{e.useProgram(null)}}function dt(e){return e.indexOf("sampler")!==-1}function ze(e,t){let s;switch(e){case"float":case"int":case"uint":case"bool":case"sampler2D":case"sampler2DArray":case"samplerCube":case"sampler3D":case"isampler2D":case"isampler2DArray":case"isamplerCube":case"isampler3D":case"usampler2D":case"usampler2DArray":case"usamplerCube":case"usampler3D":case"sampler2DShadow":case"sampler2DArrayShadow":case"samplerCubeShadow":s=0;break;case"vec2":case"ivec2":case"uvec2":case"bvec2":s=[0,0];break;case"vec3":case"ivec3":case"uvec3":case"bvec3":s=[0,0,0];break;case"vec4":case"ivec4":case"uvec4":case"bvec4":s=[0,0,0,0];break;case"mat2":case"mat2x2":s=[1,0,0,1];break;case"mat3":case"mat3x3":s=[1,0,0,0,1,0,0,0,1];break;case"mat4":case"mat4x4":s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];break;case"mat2x3":s=[1,0,0,1,0,0];break;case"mat2x4":s=[1,0,0,1,0,0,0,0];break;case"mat3x2":s=[1,0,0,0,1,0];break;case"mat3x4":s=[1,0,0,0,1,0,0,0,1,0,0,0];break;case"mat4x2":s=[1,0,0,0,0,1,0,0];break;case"mat4x3":s=[1,0,0,0,0,1,0,0,0,0,1,0];break;default:rt(e)}return t===1?s:Array(t).fill(s).flat()}var Xt=e=>typeof e=="number",xt=e=>Number.isSafeInteger(e),kt=e=>xt(e)&&e>=0,Ht=e=>typeof e=="boolean"||xt(e)&&(e===0||e===1),bt=e=>Array.isArray(e)||ArrayBuffer.isView(e),F=(e,t)=>bt(e.value)&&e.value.length==t*e.size&&e.value.every(s=>Xt(s)),Nt=(e,t)=>bt(e.value)&&e.value.length==t*e.size&&e.value.every(s=>Ht(s)),pt=(e,t)=>bt(e.value)&&e.value.length==t*e.size&&e.value.every(s=>xt(s)),St=(e,t)=>bt(e.value)&&e.value.length==t*e.size&&e.value.every(s=>kt(s)),Ge=e=>(e.value.isVec2??!1)||F(e,2),De=e=>(e.value.isVec3??!1)||F(e,3),Pe=e=>(e.value.isMat3??!1)||F(e,9),ve=e=>(e.value.isMat4??!1)||F(e,16),O=(e,t,s,i)=>`Value of uniform "${t}" must be an array of ${s*e.size} ${i}s, but is: ${JSON.stringify(e.value)}.`;function Vt(e,t,s){switch(t.type){case"float":return S(Xt(t.value),()=>`Value of uniform "${s}" must be a number!`),Mt(t.value)||I(()=>`Value of uniform "${s}" is not a safe float: ${t.value}.`),e.uniform1f(t.location,t.value);case"vec2":return S(Ge(t),()=>O(t,s,2,"number")),e.uniform2fv(t.location,t.value);case"vec3":return S(De(t),()=>O(t,s,3,"number")),e.uniform3fv(t.location,t.value);case"vec4":return S(F(t,4),()=>O(t,s,4,"number")),e.uniform4fv(t.location,t.value);case"mat2":case"mat2x2":return S(F(t,4),()=>O(t,s,4,"number")),e.uniformMatrix2fv(t.location,!1,t.value);case"mat3":case"mat3x3":return S(Pe(t),()=>O(t,s,9,"number")),e.uniformMatrix3fv(t.location,!1,t.value);case"mat4":case"mat4x4":return S(ve(t),()=>O(t,s,16,"number")),e.uniformMatrix4fv(t.location,!1,t.value);case"int":case"sampler2D":case"sampler2DArray":case"samplerCube":case"sampler3D":case"isampler2D":case"isampler2DArray":case"isamplerCube":case"isampler3D":case"usampler2D":case"usampler2DArray":case"usamplerCube":case"usampler3D":case"sampler2DShadow":case"sampler2DArrayShadow":case"samplerCubeShadow":return S(xt(t.value),()=>`Value of uniform "${s}" must be an integer!`),e.uniform1i(t.location,t.value);case"uint":return S(kt(t.value),()=>`Value of uniform "${s}" must be a positive integer!`),e.uniform1ui(t.location,t.value);case"bool":return S(Ht(t.value),()=>`Value of uniform "${s}" must be a boolean, zero or one!`),e.uniform1i(t.location,t.value?1:0);case"mat2x3":return S(F(t,6),()=>O(t,s,6,"number")),e.uniformMatrix2x3fv(t.location,!1,t.value);case"mat3x2":return S(F(t,6),()=>O(t,s,6,"number")),e.uniformMatrix3x2fv(t.location,!1,t.value);case"mat2x4":return S(F(t,8),()=>O(t,s,8,"number")),e.uniformMatrix2x4fv(t.location,!1,t.value);case"mat4x2":return S(F(t,8),()=>O(t,s,8,"number")),e.uniformMatrix4x2fv(t.location,!1,t.value);case"mat3x4":return S(F(t,12),()=>O(t,s,12,"number")),e.uniformMatrix3x4fv(t.location,!1,t.value);case"mat4x3":return S(F(t,12),()=>O(t,s,12,"number")),e.uniformMatrix4x3fv(t.location,!1,t.value);case"ivec2":return S(pt(t,2),()=>O(t,s,2,"integer")),e.uniform2iv(t.location,t.value);case"ivec3":return S(pt(t,3),()=>O(t,s,3,"integer")),e.uniform3iv(t.location,t.value);case"ivec4":return S(pt(t,4),()=>O(t,s,4,"integer")),e.uniform4iv(t.location,t.value);case"uvec2":return S(St(t,2),()=>O(t,s,2,"positive integer")),e.uniform2uiv(t.location,t.value);case"uvec3":return S(St(t,3),()=>O(t,s,3,"positive integer")),e.uniform3uiv(t.location,t.value);case"uvec4":return S(St(t,4),()=>O(t,s,4,"positive integer")),e.uniform4uiv(t.location,t.value);case"bvec2":return S(Nt(t,2),()=>O(t,s,2,"boolean")),e.uniform2iv(t.location,t.value);case"bvec3":return S(Nt(t,3),()=>O(t,s,3,"boolean")),e.uniform3iv(t.location,t.value);case"bvec4":return S(Nt(t,4),()=>O(t,s,4,"boolean")),e.uniform4iv(t.location,t.value);default:b(()=>`Unsupported type "${t.type}" of uniform "${s}".`)}}function Be(e){switch(e){case g.TEXTURE_2D:return"2D";case g.TEXTURE_3D:return"3D";case g.TEXTURE_CUBE_MAP:return"cubemap";case g.TEXTURE_2D_ARRAY:return"2D array"}}function jt(e,t){let s=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);return t===void 0?s-1:(t<0&&b(()=>`WIP texture unit cannot be negative, got: ${t}.`),t>=s&&b(()=>`Invalid WIP texture unit: ${t}, maximal texture unit available is ${s-1}.`),t)}function Le(e){if(e instanceof Uint8Array)return R.UNSIGNED_BYTE;if(e instanceof Uint16Array)return R.UNSIGNED_SHORT;if(e instanceof Uint32Array)return R.UNSIGNED_INT;if(e instanceof Float32Array)return R.FLOAT;e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array?b(()=>"Signed integer buffers are not supported when defining a texture."):b(()=>`Invalid data type: ${e.constructor.name}.`)}function Fe(e,t){e instanceof Uint8Array?t!==R.UNSIGNED_BYTE&&b(()=>"When defining a texture with a 'Uint8Array', the source data type must be 'UNSIGNED_BYTE'"):e instanceof Uint8ClampedArray?t!==R.UNSIGNED_BYTE&&b(()=>"When defining a texture with a 'Uint8ClampedArray'source data type must be 'UNSIGNED_BYTE'"):e instanceof Float32Array?t!==R.FLOAT&&b(()=>"When defining a texture with a 'Float32Array', the source data type must be 'FLOAT'"):e instanceof Uint16Array?[R.UNSIGNED_SHORT,R.UNSIGNED_SHORT_5_6_5,R.UNSIGNED_SHORT_5_5_5_1,R.UNSIGNED_SHORT_4_4_4_4,R.HALF_FLOAT].includes(t)||b(()=>"When defining a texture with a 'Uint16Array', the source data type must be one of 'UNSIGNED_SHORT', 'UNSIGNED_SHORT_5_6_5', 'UNSIGNED_SHORT_5_5_5_1', 'UNSIGNED_SHORT_4_4_4_4', or 'HALF_FLOAT'"):e instanceof Uint32Array?[R.UNSIGNED_INT,R.UNSIGNED_INT_5_9_9_9_REV,R.UNSIGNED_INT_2_10_10_10_REV,R.UNSIGNED_INT_10F_11F_11F_REV,R.UNSIGNED_INT_24_8].includes(t)||b(()=>"When defining a texture with a 'Uint32Array', the source data type must be one of 'UNSIGNED_INT', 'UNSIGNED_INT_5_9_9_9_REV', 'UNSIGNED_INT_2_10_10_10_REV', 'UNSIGNED_INT_10F_11F_11F_REV', or'UNSIGNED_INT_24_8'"):e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array?b(()=>"Signed integer buffers are not supported when defining a texture."):b(()=>`Invalid data type for texture: ${e.constructor.name}`)}function Ce(e,t){switch(e){case y.R8:return t===R.UNSIGNED_BYTE;case y.R16F:return[R.HALF_FLOAT,R.FLOAT].includes(t);case y.R32F:return t==R.FLOAT;case y.R8UI:return t===R.UNSIGNED_BYTE;case y.RG8:return t===R.UNSIGNED_BYTE;case y.RG16F:return[R.HALF_FLOAT,R.FLOAT].includes(t);case y.RG32F:return t==R.FLOAT;case y.RG8UI:return t===R.UNSIGNED_BYTE;case y.RGB8:return t===R.UNSIGNED_BYTE;case y.SRGB8:return t===R.UNSIGNED_BYTE;case y.RGB565:return[R.UNSIGNED_BYTE,R.UNSIGNED_SHORT_5_6_5].includes(t);case y.R11F_G11F_B10F:return[R.UNSIGNED_INT_10F_11F_11F_REV,R.HALF_FLOAT,R.FLOAT].includes(t);case y.RGB9_E5:return[R.HALF_FLOAT,R.FLOAT].includes(t);case y.RGB16F:return[R.HALF_FLOAT,R.FLOAT].includes(t);case y.RGB32F:return t==R.FLOAT;case y.RGB8UI:return t===R.UNSIGNED_BYTE;case y.RGBA8:return t===R.UNSIGNED_BYTE;case y.SRGB8_ALPHA8:return t===R.UNSIGNED_BYTE;case y.RGB5_A1:return[R.UNSIGNED_BYTE,R.UNSIGNED_SHORT_5_5_5_1].includes(t);case y.RGB10_A2:return t===R.UNSIGNED_INT_2_10_10_10_REV;case y.RGBA4:return[R.UNSIGNED_BYTE,R.UNSIGNED_SHORT_4_4_4_4].includes(t);case y.RGBA16F:return[R.HALF_FLOAT,R.FLOAT].includes(t);case y.RGBA32F:return t==R.FLOAT;case y.RGBA8UI:return t===R.UNSIGNED_BYTE;case y.DEPTH_COMPONENT16:return t===R.UNSIGNED_SHORT;case y.DEPTH_COMPONENT24:return t===R.UNSIGNED_INT;case y.DEPTH_COMPONENT32F:return t===R.FLOAT}return!1}function Xe(e,t){switch(t){case y.R8:return e.RED;case y.R16F:return e.RED;case y.R32F:return e.RED;case y.R8UI:return e.RED_INTEGER;case y.RG8:return e.RG;case y.RG16F:return e.RG;case y.RG32F:return e.RG;case y.RG8UI:return e.RG_INTEGER;case y.RGB8:return e.RGB;case y.SRGB8:return e.RGB;case y.RGB565:return e.RGB;case y.R11F_G11F_B10F:return e.RGB;case y.RGB9_E5:return e.RGB;case y.RGB16F:return e.RGB;case y.RGB32F:return e.RGB;case y.RGB8UI:return e.RGB_INTEGER;case y.RGBA8:return e.RGBA;case y.SRGB8_ALPHA8:return e.RGBA;case y.RGB5_A1:return e.RGBA;case y.RGB10_A2:return e.RGBA;case y.RGBA4:return e.RGBA;case y.RGBA16F:return e.RGBA;case y.RGBA32F:return e.RGBA;case y.RGBA8UI:return e.RGBA_INTEGER;case y.DEPTH_COMPONENT16:case y.DEPTH_COMPONENT24:case y.DEPTH_COMPONENT32F:return e.DEPTH_COMPONENT;default:b(()=>`Invalid internal format: ${t}.`)}}function ke(e){switch(e){case y.DEPTH_COMPONENT16:case y.DEPTH_COMPONENT24:case y.DEPTH_COMPONENT32F:return!0;default:return!1}}function He(e){switch(e){case y.R16F:case y.R32F:case y.RG16F:case y.RG32F:case y.RGB16F:case y.RGB32F:case y.RGBA16F:case y.RGBA32F:case y.DEPTH_COMPONENT32F:return!0;default:return!1}}function Ve(e){let t=!!e.createTransformFeedback;t&&e.bindVertexArray(null);let s=e.getParameter(e.MAX_VERTEX_ATTRIBS),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i);for(let h=0;h<s;++h)e.disableVertexAttribArray(h),e.vertexAttribPointer(h,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(h,0),t&&e.vertexAttribDivisor(h,0);e.deleteBuffer(i);let n=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(let h=0;h<n;++h)e.activeTexture(e.TEXTURE0+h),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null),t&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null),e.bindSampler(h,null));if(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),t){e.drawBuffers([e.BACK]),e.readBuffer(e.BACK),e.bindBuffer(e.COPY_READ_BUFFER,null),e.bindBuffer(e.COPY_WRITE_BUFFER,null),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),e.bindBuffer(e.PIXEL_UNPACK_BUFFER,null);let h=e.getParameter(e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS);for(let r=0;r<h;++r)e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,r,null);let a=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);for(let r=0;r<a;++r)e.bindBufferBase(e.UNIFORM_BUFFER,r,null);e.disable(e.RASTERIZER_DISCARD),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,0),e.pixelStorei(e.UNPACK_SKIP_IMAGES,0),e.pixelStorei(e.UNPACK_ROW_LENGTH,0),e.pixelStorei(e.UNPACK_SKIP_ROWS,0),e.pixelStorei(e.UNPACK_SKIP_PIXELS,0),e.pixelStorei(e.PACK_ROW_LENGTH,0),e.pixelStorei(e.PACK_SKIP_ROWS,0),e.pixelStorei(e.PACK_SKIP_PIXELS,0),e.hint(e.FRAGMENT_SHADER_DERIVATIVE_HINT,e.DONT_CARE)}}async function Yt(e){let t=await je(e);return{data:Ye(t.data,t.exposure),width:t.width,height:t.height}}async function je(e){let s=await(await fetch(e)).arrayBuffer(),i=new Uint8Array(s),n="",h=0;for(;!n.match(/\n\n[^\n]+\n/g)&&h<i.length;)n+=String.fromCharCode(i[h++]);h>=i.length&&b(()=>"HDR header not found"),n.startsWith(`#?RADIANCE
`)||b(()=>"Missing #?RADIANCE identifier");let a=n.match(/FORMAT=(.*)$/m)?.[1];a!="32-bit_rle_rgbe"&&(a==="32-bit_rle_xyze"&&b(()=>"XYZE HDR format is not supported"),b(()=>`Not a valid HDR format: ${a}`));let r=1;for(let E of n.matchAll(/EXPOSURE=([^\n]*)\n/gm)){let x=parseFloat(E[1]);isNaN(x)&&b(()=>"Invalid HDR exposure"),r*=x}let o=n.split(/\n/).reverse()[1].split(" "),c=parseInt(o[3]),f=parseInt(o[1]);(c<8||c>32767||f<8||f>32767)&&b(()=>"Invalid HDR resolution");let d=!0;(i[h]!=2||i[h+1]!=2||i[h+2]&128)&&(d=!1);let l;if(d){l=new Uint8Array(c*f*4);let E=0;for(let x=0;x<f;x++){let A=i.slice(h,h+=4);(A[2]<<8)+A[3]!=c&&b(()=>"HDR line mismatch");let _=Array(c*4);for(var u=0;u<4;u++){let w=u*c,M=(u+1)*c;for(;w<M;){let[T,N]=i.slice(h,h+=2);if(T>128)for(T-=128;T-- >0;)_[w++]=N;else for(T-=1,_[w++]=N;T-- >0;)_[w++]=i[h++]}}for(var u=0;u<c;u++)l[E++]=_[u+c*0],l[E++]=_[u+c*1],l[E++]=_[u+c*2],l[E++]=_[u+c*3]}}else{l=i.slice(h);for(let E=0;E<l.length;E+=4)l[E]==1&&l[E+1]==1&&l[E+2]==1&&b(()=>"Old HDR RLE encoding is not supported")}return{data:l,width:c,height:f,exposure:r}}function Ye(e,t){let s=e.byteLength/4,i=new Float32Array(s*3);for(var n=0;n<s;n++){let h=e[n*4+3];if(h==0)i[n*3+0]=0,i[n*3+1]=0,i[n*3+2]=0;else{let a=Math.pow(2,h-136)/t;i[n*3+0]=e[n*4+0]*a,i[n*3+1]=e[n*4+1]*a,i[n*3+2]=e[n*4+2]*a}}return i}async function We(e,t,s={}){let i=t.split("/").at(-1).split(".").at(0),n;try{if(t.endsWith(".hdr")){s.srcDataType!==void 0&&s.srcDataType!==e.FLOAT&&I(()=>`Ignoring srcDataType option for HDR texture: ${s.srcDataType}`),s.internalFormat===void 0&&(s.internalFormat=y.R11F_G11F_B10F);let h=await Yt(new URL(t,window.location.href));n=et(e,i,h.width,h.height,s),ut(e,n,h.data,{...s,srcDataType:e.FLOAT})}else{let a=await new Promise((r,o)=>{let c=new Image;c.onload=()=>r(c),c.onerror=o,new URL(t,window.location.href).origin!==window.location.origin&&(c.crossOrigin="anonymous"),c.src=t});n=et(e,i,a.naturalWidth,a.naturalHeight,s),ut(e,n,a,s)}return n}catch(h){n!==void 0&&e.deleteTexture(n.glo),b(()=>`Failed to create texture from url: "${t}": ${h.message}`)}}async function qe(e,t,s={}){if(t.length!==6)throw new Error(`loadCubemap requires 6 URLs, got ${t.length}`);let i=t.map(h=>new Promise((a,r)=>{let o=new Image;o.onload=()=>a(o),o.onerror=r,new URL(h,window.location.href).origin!==window.location.origin&&(o.crossOrigin="anonymous"),o.src=h})),n=t[0].split("/").at(-1).split(".").at(0);n.endsWith("-px")?n=n.slice(0,-3):n.endsWith("-right")&&(n=n.slice(0,-6));try{let h=await Promise.all(i),[a,r]=[h[0].naturalWidth,h[0].naturalHeight];for(let c=1;c<6;c++)(h[c].naturalWidth!==a||h[c].naturalHeight!==r)&&b(()=>`Cubemap images at index 0 and ${c} have different dimensions: ${a}x${r} vs ${h[c].naturalWidth}x${h[c].naturalHeight}`);let o=et(e,n,a,r,{...s,target:e.TEXTURE_CUBE_MAP});for(let c=0;c<6;c++)ut(e,o,h[c],{...s,dataTarget:e.TEXTURE_CUBE_MAP_POSITIVE_X+c});return o}catch(h){b(()=>`Failed to create cubemap texture from urls: "${t}": ${h.message}`)}}async function Ke(e,t,s={}){let[i,n]=[void 0,void 0],h=t.length,a=[];for(let d of t)a.push(new Promise((l,u)=>{let E=d,x=new Image;x.onload=()=>{i===void 0&&n===void 0?(i=x.naturalWidth,n=x.naturalHeight):(x.naturalWidth!==i||x.naturalHeight!==n)&&u(new Error(`Data volume slices must have the same dimensions, but slice ${E} has dimensions ${x.naturalWidth}x${x.naturalHeight} instead of ${i}x${n}`)),l(x)},x.onerror=u,new URL(E,window.location.href).origin!==window.location.origin&&(x.crossOrigin="anonymous"),x.src=E}));let r=t[0].split("/").at(-1).split(".").at(0);r=r.replace(/[-_.]*\d+$/,""),await Promise.all(a),(i===void 0||n===void 0||a.length===0)&&b(()=>"No slices were loaded");let c=new OffscreenCanvas(i,n).getContext("2d",{willReadFrequently:!0});c===null&&b(()=>"Failed to create 2D context for offscreen canvas");let f=et(e,r,i,n,{target:e.TEXTURE_3D,depth:h,levels:s.levels??1,filter:s.filter??$.LINEAR,internalFormat:s.internalFormat??y.R16F});try{e.bindTexture(e.TEXTURE_3D,f.glo);let d=s.input_min??0,l=s.input_max??255,u=s.output_min??0,E=s.output_max??1,x=l-d,A=E-u;for(let _=0;_<h;_++){let w=await a[_];c.drawImage(w,0,0);let M=c.getImageData(0,0,i,n),T=new Uint8ClampedArray(M.data.buffer);T.length!==i*n*4&&b(()=>`Unexpected pixel data length: ${T.length} instead of ${i*n*4}`);let N=new Float32Array(i*n);for(let p=0;p<N.length;p++){let X=L(T[p*4],d,l);N[p]=u+(X-d)/x*A}e.texSubImage3D(e.TEXTURE_3D,0,0,0,_,i,n,1,e.RED,e.FLOAT,N)}return s.levels!==1&&e.generateMipmap(e.TEXTURE_3D),f}catch(d){e.deleteTexture(f.glo),b(()=>`Failed to create volume data texture "${r}": ${d.message}`)}finally{e.bindTexture(e.TEXTURE_3D,null)}}var Ut=class{_stack=[];push(t,s,i){i===s&&(i=void 0);let[n,h]=this._stack.at(-1)??[null,void 0];if(!(n===s&&h===i)){this._stack.push([s,i]);try{this._bindFramebuffer(t,s,i)}catch(a){throw this.pop(t),a}}}pop(t,s=1){s=Math.max(0,s);for(let i=0;i<s;i++){this._stack.pop();let[n,h]=this._stack.at(-1)??[null,void 0];this._bindFramebuffer(t,n,h)}}_bindFramebuffer(t,s,i){if(i===void 0){let[n,h]=s===null?[t.canvas.width,t.canvas.height]:Wt(s);t.bindFramebuffer(t.FRAMEBUFFER,s?.glo??null),t.viewport(0,0,n,h)}else{let[n,h]=i===null?[t.canvas.width,t.canvas.height]:Wt(i);t.bindFramebuffer(t.READ_FRAMEBUFFER,s?.glo??null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i?.glo??null),t.viewport(0,0,n,h)}}};function Wt(e){if(e.color.length>0){let t=e.color[0].attachment;return[t.width,t.height]}else if(e.depth!==null){let t=e.depth.attachment;return[t.width,t.height]}else if(e.stencil!==null){let t=e.stencil.attachment;return[t.width,t.height]}else b(()=>`Framebuffer ${e.name} has no attachments`)}var At=class{_ext;_query;constructor(t,s){this._ext=s,this._query=t.createQuery(),t.beginQuery(this._ext.TIME_ELAPSED_EXT,this._query)}stop(t,s){t.endQuery(this._ext.TIME_ELAPSED_EXT);let i=()=>{if(this._query===null){I(()=>"WebGLTimer query has ended already");return}let n=t.getQueryParameter(this._query,t.QUERY_RESULT_AVAILABLE),h=t.getParameter(this._ext.GPU_DISJOINT_EXT);if(n&&!h){let a=t.getQueryParameter(this._query,t.QUERY_RESULT);s(a/1e6)}if(n||h){t.deleteQuery(this._query),this._query=null;return}requestAnimationFrame(i)};setTimeout(i,0)}},gt=class{_ext;constructor(t){this._ext=t.getExtension("EXT_disjoint_timer_query_webgl2"),this._ext===null&&(this._ext=t.getExtension("EXT_disjoint_timer_query")),this._ext===null&&b(()=>"WebGL2 Timer Query extension not supported. In Firefox, enable `webgl.enable-privileged-extensions` in `about:config`")}start(t){return new At(t,this._ext)}};var B=class e{a;b;c;d;e;f;g;h;i;static of(t,s,i,n,h,a,r,o,c){return new e(t,s,i,n,h,a,r,o,c)}static identity(){return new e}static translate(t){return new e(1,0,0,0,1,0,t.x,t.y,1)}static translateX(t){return new e(1,0,0,0,1,0,t,0,1)}static translateY(t){return new e(1,0,0,0,1,0,0,t,1)}static rotate(t){let s=Math.sin(t),i=Math.cos(t);return new e(i,s,0,-s,i,0,0,0,1)}static scale(t,s){return typeof t=="number"?s===void 0?new e(t,0,0,0,t,0,0,0,1):new e(t,0,0,0,s,0,0,0,1):new e(t.x,0,0,0,t.y,0,0,0,1)}static scaleX(t){return new e(t,0,0,0,1,0,0,0,1)}static scaleY(t){return new e(1,0,0,0,t,0,0,0,1)}static random(){return new e(Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random())}static fromArray(t,s=0){if(t.length<s+9)throw new Error(`Cannot create a Mat3 at offset ${s} in array of length ${t.length}`);return new e(t[s+0],t[s+1],t[s+2],t[s+3],t[s+4],t[s+5],t[s+6],t[s+7],t[s+8])}static fromMat4(t){return new e(t.a,t.b,t.c,t.e,t.f,t.g,t.i,t.j,t.k)}static projection(t,s){return new e(2/t,0,0,0,-2/s,0,-1,1,1)}static normalMatrixOf(t){let s=t.a,i=t.b,n=t.c,h=t.e,a=t.f,r=t.g,o=t.i,c=t.j,f=t.k,d=f*a-r*c,l=-f*h+r*o,u=c*h-a*o,E=s*d+i*l+n*u;return E?(E=1/E,new e(d*E,l*E,u*E,(-f*i+n*c)*E,(f*s-n*o)*E,(-c*s+i*o)*E,(r*i-n*a)*E,(-r*s+n*h)*E,(a*s-i*h)*E)):null}constructor(t=1,s=0,i=0,n=0,h=1,a=0,r=0,o=0,c=1){this.a=t,this.b=s,this.c=i,this.d=n,this.e=h,this.f=a,this.g=r,this.h=o,this.i=c}get 0(){return this.a}get 1(){return this.b}get 2(){return this.c}get 3(){return this.d}get 4(){return this.e}get 5(){return this.f}get 6(){return this.g}get 7(){return this.h}get 8(){return this.i}get length(){return 9}toString(){return`Mat3 | ${this.a} ${this.b} ${this.c} |
     | ${this.d} ${this.e} ${this.f} |
     | ${this.g} ${this.h} ${this.i} |`}toArray(t=null,s=0){return t===null&&(t=new Array(9)),t[s+0]=this.a,t[s+1]=this.b,t[s+2]=this.c,t[s+3]=this.d,t[s+4]=this.e,t[s+5]=this.f,t[s+6]=this.g,t[s+7]=this.h,t[s+8]=this.i,t}clone(){return new e(this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i)}copy(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this.g=t.g,this.h=t.h,this.i=t.i,this}equals(t,s=D){return Math.abs(this.a-t.a)<=s&&Math.abs(this.b-t.b)<=s&&Math.abs(this.c-t.c)<=s&&Math.abs(this.d-t.d)<=s&&Math.abs(this.e-t.e)<=s&&Math.abs(this.f-t.f)<=s&&Math.abs(this.g-t.g)<=s&&Math.abs(this.h-t.h)<=s&&Math.abs(this.i-t.i)<=s}transpose(){return new e(this.a,this.d,this.g,this.b,this.e,this.h,this.c,this.f,this.i)}invert(){let t=this.i*this.e-this.f*this.h,s=-this.i*this.d+this.f*this.g,i=this.h*this.d-this.e*this.g,n=this.a*t+this.b*s+this.c*i;return n?(n=1/n,new e(t*n,(-this.i*this.b+this.c*this.h)*n,(this.f*this.b-this.c*this.e)*n,s*n,(this.i*this.a-this.c*this.g)*n,(-this.f*this.a+this.c*this.d)*n,i*n,(-this.h*this.a+this.b*this.g)*n,(this.e*this.a-this.b*this.d)*n)):null}adjoint(){return new e(this.e*this.i-this.f*this.h,this.c*this.h-this.b*this.i,this.b*this.f-this.c*this.e,this.f*this.g-this.d*this.i,this.a*this.i-this.c*this.g,this.c*this.d-this.a*this.f,this.d*this.h-this.e*this.g,this.b*this.g-this.a*this.h,this.a*this.e-this.b*this.d)}determinant(){return this.a*(this.i*this.e-this.f*this.h)+this.b*(-this.i*this.d+this.f*this.g)+this.c*(this.h*this.d-this.e*this.g)}mul(t){return new e(this.a*t.a+this.d*t.b+this.g*t.c,this.b*t.a+this.e*t.b+this.h*t.c,this.c*t.a+this.f*t.b+this.i*t.c,this.a*t.d+this.d*t.e+this.g*t.f,this.b*t.d+this.e*t.e+this.h*t.f,this.c*t.d+this.f*t.e+this.i*t.f,this.a*t.g+this.d*t.h+this.g*t.i,this.b*t.g+this.e*t.h+this.h*t.i,this.c*t.g+this.f*t.h+this.i*t.i)}premul(t){return new e(t.a*this.a+t.d*this.b+t.g*this.c,t.b*this.a+t.e*this.b+t.h*this.c,t.c*this.a+t.f*this.b+t.i*this.c,t.a*this.d+t.d*this.e+t.g*this.f,t.b*this.d+t.e*this.e+t.h*this.f,t.c*this.d+t.f*this.e+t.i*this.f,t.a*this.g+t.d*this.h+t.g*this.i,t.b*this.g+t.e*this.h+t.h*this.i,t.c*this.g+t.f*this.h+t.i*this.i)}translate(t,s){let i;return typeof t=="number"?(i=t,s=s??0):(i=t.x,s=t.y),new e(this.a,this.b,this.c,this.d,this.e,this.f,this.g+this.a*i+this.d*s,this.h+this.b*i+this.e*s,this.i+this.c*i+this.f*s)}translateX(t){return new e(this.a,this.b,this.c,this.d,this.e,this.f,this.g+this.a*t,this.h+this.b*t,this.i+this.c*t)}translateY(t){return new e(this.a,this.b,this.c,this.d,this.e,this.f,this.g+this.d*t,this.h+this.e*t,this.i+this.f*t)}rotate(t){let s=Math.sin(t),i=Math.cos(t);return new e(i*this.a+s*this.d,i*this.b+s*this.e,i*this.c+s*this.f,i*this.d-s*this.a,i*this.e-s*this.b,i*this.f-s*this.c,this.g,this.h,this.i)}scale(t,s){let i;return typeof t=="number"?(i=t,s=s??i):(i=t.x,s=t.y),new e(this.a*i,this.b*i,this.c*i,this.d*s,this.e*s,this.f*s,this.g,this.h,this.i)}scaleX(t){return new e(this.a*t,this.b*t,this.c*t,this.d,this.e,this.f,this.g,this.h,this.i)}scaleY(t){return new e(this.a,this.b,this.c,this.d*t,this.e*t,this.f*t,this.g,this.h,this.i)}*[Symbol.iterator](){yield this.a,yield this.b,yield this.c,yield this.d,yield this.e,yield this.f,yield this.g,yield this.h,yield this.i}};B.prototype.isMat3=!0;B.prototype.isMathPrimitive=!0;var U=class e{x;y;z;static zero(){return new e(0,0,0)}static of(t,s,i){return new e(t,s??t,i??t)}static xAxis(){return new e(1,0,0)}static yAxis(){return new e(0,1,0)}static zAxis(){return new e(0,0,1)}static translateX(t){return new e(t,0,0)}static translateY(t){return new e(0,t,0)}static translateZ(t){return new e(0,0,t)}static random(){return new e(Math.random(),Math.random(),Math.random())}static randomUnit(){let t,s,i,n=0;for(;t=Math.random()*2-1,s=Math.random()*2-1,i=Math.random()*2-1,n=Math.hypot(t,s,i),!(n>0););return new e(t/n,s/n,i/n)}static fromArray(t,s=0){if(t.length<s+3)throw new Error(`Cannot create a Vec3 at offset ${s} in array of length ${t.length}`);return new e(t[s],t[s+1],t[s+2])}static fromSpherical(t,s,i=1){let n=Math.sin(s)*i;return new e(n*Math.sin(t),Math.cos(s)*i,n*Math.cos(t))}static fromCylindrical(t,s,i=1){return new e(Math.sin(t)*i,s,Math.cos(t)*i)}fromHermite(t,s,i,n,h){let a=h*h,r=a*(2*h-3)+1,o=a*(h-2)+h,c=a*(h-1),f=a*(3-2*h);return new e(t.x*r+s.x*o+i.x*c+n.x*f,t.y*r+s.y*o+i.y*c+n.y*f,t.z*r+s.z*o+i.z*c+n.z*f)}fromBezier(t,s,i,n,h){let a=h*h,r=1-h,o=r*r,c=o*r,f=3*h*o,d=3*a*r,l=a*h;return new e(t.x*c+s.x*f+i.x*d+n.x*l,t.y*c+s.y*f+i.y*d+n.y*l,t.z*c+s.z*f+i.z*d+n.z*l)}constructor(t=0,s=0,i=0){this.x=t,this.y=s,this.z=i}get 0(){return this.x}set 0(t){this.x=t}get 1(){return this.y}set 1(t){this.y=t}get 2(){return this.z}set 2(t){this.z=t}get length(){return 3}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}get depth(){return this.z}set depth(t){this.z=t}get r(){return this.x}set r(t){this.x=t}get g(){return this.y}set g(t){this.y=t}get b(){return this.z}set b(t){this.z=t}get u(){return this.x}set u(t){this.x=t}get v(){return this.y}set v(t){this.y=t}get w(){return this.z}set w(t){this.z=t}getIndex(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error(`Invalid Vec3 index: ${t}`)}}setIndex(t,s){switch(t){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;default:throw new Error(`Invalid Vec3 index: ${t}`)}}toArray(t=null,s=0){return t===null&&(t=new Array(3)),t[s]=this.x,t[s+1]=this.y,t[s+2]=this.z,t}clone(){return new e(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}equals(t,s=D){return Math.abs(this.x-t.x)<=s&&Math.abs(this.y-t.y)<=s&&Math.abs(this.z-t.z)<=s}any(){return this.x!=0||this.y!=0||this.z!=0}set(t,s,i){return this.x=t,this.y=s??t,this.z=i??(s===void 0?t:0),this}add(t){return typeof t=="number"?new e(this.x+t,this.y+t,this.z+t):new e(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return typeof t=="number"?new e(this.x-t,this.y-t,this.z-t):new e(this.x-t.x,this.y-t.y,this.z-t.z)}mul(t){return typeof t=="number"?new e(this.x*t,this.y*t,this.z*t):new e(this.x*t.x,this.y*t.y,this.z*t.z)}div(t){return typeof t=="number"?new e(this.x/t,this.y/t,this.z/t):new e(this.x/t.x,this.y/t.y,this.z/t.z)}negate(){return new e(-this.x,-this.y,-this.z)}invert(){return new e(this.x==0?0:1/this.x,this.y==0?0:1/this.y,this.z==0?0:1/this.z)}mod(t){return typeof t=="number"?new e(this.x%t,this.y%t,this.z%t):new e(this.x%t.x,this.y%t.y,this.z%t.z)}lerp(t,s){return new e(this.x+(t.x-this.x)*s,this.y+(t.y-this.y)*s,this.z+(t.z-this.z)*s)}slerp(t,s){let i=this.x,n=this.y,h=this.z,a=t.x,r=t.y,o=t.z,c=Math.acos(Math.min(Math.max(i*a+n*r+h*o,-1),1)),f=c?Math.sin(c):1,d=Math.sin((1-s)*c)/f,l=Math.sin(s*c)/f;return new e(d*i+l*a,d*n+l*r,d*h+l*o)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){let s=this.x,i=this.y,n=this.z,h=t.x,a=t.y,r=t.z;return new e(i*r-n*a,n*h-s*r,s*a-i*h)}magSq(){return this.x*this.x+this.y*this.y+this.z*this.z}magnitude(){return Math.hypot(this.x,this.y,this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){let t=this.x*this.x+this.y*this.y+this.z*this.z;if(t>0){let s=1/Math.sqrt(t);return new e(this.x*s,this.y*s,this.z*s)}return new e(0,0,0)}distanceTo(t){return Math.hypot(this.x-t.x,this.y-t.y,this.z-t.z)}distanceToSq(t){let s=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return s*s+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}min(t){return typeof t=="number"?new e(Math.min(this.x,t),Math.min(this.y,t),Math.min(this.z,t)):new e(Math.min(this.x,t.x),Math.min(this.y,t.y),Math.min(this.z,t.z))}max(t){return typeof t=="number"?new e(Math.max(this.x,t),Math.max(this.y,t),Math.max(this.z,t)):new e(Math.max(this.x,t.x),Math.max(this.y,t.y),Math.max(this.z,t.z))}clamp(t,s){let i=typeof t=="number"?t:t.x,n=typeof s=="number"?s:s.x,h=typeof t=="number"?t:t.y,a=typeof s=="number"?s:s.y,r=typeof t=="number"?t:t.z,o=typeof s=="number"?s:s.z;return new e(Math.max(i,Math.min(n,this.x)),Math.max(h,Math.min(a,this.y)),Math.max(r,Math.min(o,this.z)))}clampMagnitude(t,s){let i=this.x*this.x+this.y*this.y+this.z*this.z;if(i>0){let n=Math.sqrt(i),h=Math.max(t,Math.min(s,n))/n;return new e(this.x*h,this.y*h,this.z*h)}return new e(0,0,0)}abs(){return new e(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z))}floor(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}ceil(){return new e(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}round(){return new e(Math.round(this.x),Math.round(this.y),Math.round(this.z))}trunc(){return new e(Math.trunc(this.x),Math.trunc(this.y),Math.trunc(this.z))}projectOnVector(t){let s=t.x,i=t.y,n=t.z,h=s*s+i*i+n*n;if(h==0)return new e(0,0,0);{let a=(this.x*s+this.y*i+this.z*n)/h;return new e(s*a,i*a,n*a)}}projectOnPlane(t){let s=t.x,i=t.y,n=t.z,h=this.x*s+this.y*i+this.z*n;return new e(this.x-s*h,this.y-i*h,this.z-n*h)}reflect(t){let s=t.x,i=t.y,n=t.z,h=2*(this.x*s+this.y*i+this.z*n);return new e(this.x-s*h,this.y-i*h,this.z-n*h)}angleTo(t){let s=this.x,i=this.y,n=this.z,h=t.x,a=t.y,r=t.z,o=Math.sqrt((s*s+i*i+n*n)*(h*h+a*a+r*r)),c=o&&(s*h+i*a+n*r)/o;return Math.acos(Math.min(Math.max(c,-1),1))}translateX(t){return new e(this.x+t,this.y,this.z)}translateY(t){return new e(this.x,this.y+t,this.z)}translateZ(t){return new e(this.x,this.y,this.z+t)}rotateX(t){let s=this.y,i=this.z,n=Math.cos(t),h=Math.sin(t);return new e(this.x,s*n-i*h,s*h+i*n)}rotateY(t){let s=this.x,i=this.z,n=Math.cos(t),h=Math.sin(t);return new e(s*n+i*h,this.y,-s*h+i*n)}rotateZ(t){let s=this.x,i=this.y,n=Math.cos(t),h=Math.sin(t);return new e(s*n-i*h,s*h+i*n,this.z)}rotateAround(t,s){let i=this.x,n=this.y,h=this.z,a=t.x,r=t.y,o=t.z,c=Math.cos(s),f=Math.sin(s),d=(a*i+r*n+o*h)*(1-c);return new e(a*d+i*c+(-o*n+r*h)*f,r*d+n*c+(o*i-a*h)*f,o*d+h*c+(-r*i+a*n)*f)}applyMat3(t){let s=this.x,i=this.y,n=this.z;return new e(s*t.a+i*t.d+n*t.g,s*t.b+i*t.e+n*t.h,s*t.c+i*t.f+n*t.i)}applyMat4(t){let s=this.x,i=this.y,n=this.z,h=t.d*s+t.h*i+t.l*n+t.p||1;return new e((s*t.a+i*t.e+n*t.i+t.m)/h,(s*t.b+i*t.f+n*t.j+t.n)/h,(s*t.c+i*t.g+n*t.k+t.o)/h)}rotateMat4(t){let s=this.x,i=this.y,n=this.z;return new e(s*t.a+i*t.e+n*t.i,s*t.b+i*t.f+n*t.j,s*t.c+i*t.g+n*t.k)}rotateQuat(t){let s=this.x,i=this.y,n=this.z,h=t.x,a=t.y,r=t.z,o=t.w,c=2*(a*n-r*i),f=2*(r*s-h*n),d=2*(h*i-a*s);return new e(s+o*c+a*d-r*f,i+o*f+r*c-h*d,n+o*d+h*f-a*c)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};U.prototype.isVec3=!0;U.prototype.isMathPrimitive=!0;var st=class e{a;b;c;d;e;f;g;h;i;j;k;l;m;n;o;p;static of(t,s,i,n,h,a,r,o,c,f,d,l,u,E,x,A){return new e(t,s,i,n,h,a,r,o,c,f,d,l,u,E,x,A)}static identity(){return new e}static translate(t,s,i){return typeof t=="number"?new e(1,0,0,0,0,1,0,0,0,0,1,0,t,s??t,i??t,1):new e(1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1)}static translateX(t){return new e(1,0,0,0,0,1,0,0,0,0,1,0,t,0,0,1)}static translateY(t){return new e(1,0,0,0,0,1,0,0,0,0,1,0,0,t,0,1)}static translateZ(t){return new e(1,0,0,0,0,1,0,0,0,0,1,0,0,0,t,1)}static rotate(t,s){let i=Math.sin(s),n=Math.cos(s),h=1-n,a=t.x,r=t.y,o=t.z,c=h*a,f=h*r,d=h*o,l=i*a,u=i*r,E=i*o;return new e(c*a+n,c*r+E,c*o-u,0,f*a-E,f*r+n,f*o+l,0,d*a+u,d*r-l,d*o+n,0,0,0,0,1)}static rotateX(t){let s=Math.sin(t),i=Math.cos(t);return new e(1,0,0,0,0,i,s,0,0,-s,i,0,0,0,0,1)}static rotateY(t){let s=Math.sin(t),i=Math.cos(t);return new e(i,0,-s,0,0,1,0,0,s,0,i,0,0,0,0,1)}static rotateZ(t){let s=Math.sin(t),i=Math.cos(t);return new e(i,s,0,0,-s,i,0,0,0,0,1,0,0,0,0,1)}static fromQuat(t){let s=t.x,i=t.y,n=t.z,h=t.w,a=s+s,r=i+i,o=n+n,c=s*a,f=s*r,d=s*o,l=i*r,u=i*o,E=n*o,x=h*a,A=h*r,_=h*o;return new e(1-(l+E),f+_,d-A,0,f-_,1-(c+E),u+x,0,d+A,u-x,1-(c+l),0,0,0,0,1)}static scale(t){let s,i,n;return typeof t=="number"?(s=t,i=t,n=t):(s=t.x,i=t.y,n=t.z),new e(s,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1)}static random(){return new e(Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random())}static fromArray(t,s=0){if(t.length<s+16)throw new Error(`Cannot create a Mat4 at offset ${s} in array of length ${t.length}`);return new e(t[s+0],t[s+1],t[s+2],t[s+3],t[s+4],t[s+5],t[s+6],t[s+7],t[s+8],t[s+9],t[s+10],t[s+11],t[s+12],t[s+13],t[s+14],t[s+15])}static fromMat3(t){return new e(t.a,t.b,t.c,0,t.d,t.e,t.f,0,t.g,t.h,t.i,0,0,0,0,1)}static fromVec3s(t,s,i,n){return n===void 0&&(n=U.of(0)),new e(t.x,t.y,t.z,0,s.x,s.y,s.z,0,i.x,i.y,i.z,0,n.x,n.y,n.z,1)}static fromVec4s(t,s,i,n){return new e(t.x,t.y,t.z,t.w,s.x,s.y,s.z,s.w,i.x,i.y,i.z,i.w,n.x,n.y,n.z,n.w)}static compose(t,s,i){let n=s.x,h=s.y,a=s.z,r=s.w,o=i.x,c=i.y,f=i.z,d=n+n,l=h+h,u=a+a,E=n*d,x=n*l,A=n*u,_=h*l,w=h*u,M=a*u,T=r*d,N=r*l,p=r*u;return new e((1-(_+M))*o,(x+p)*o,(A-N)*o,0,(x-p)*c,(1-(E+M))*c,(w+T)*c,0,(A+N)*f,(w-T)*f,(1-(E+_))*f,0,t.x,t.y,t.z,1)}static ortho(t,s,i,n,h,a){let r=1/(t-s),o=1/(i-n),c=1/(h-a);return new e(-2*r,0,0,0,0,-2*o,0,0,0,0,2*c,0,(t+s)*r,(i+n)*o,(h+a)*c,1)}static perspective(t,s,i,n){let h=1/Math.tan(t/2),a=1/(i-n);return new e(h/s,0,0,0,0,h,0,0,0,0,(n+i)*a,-1,0,0,2*n*i*a,0)}static lookAt(t,s,i){let n=t.x,h=t.y,a=t.z,r=n-s.x,o=h-s.y,c=a-s.z;if(Math.abs(r)==0&&Math.abs(o)==0&&Math.abs(c)==0)return new e;let f=1/Math.hypot(r,o,c);r*=f,o*=f,c*=f;let d=i.x,l=i.y,u=i.z,E=l*c-u*o,x=u*r-d*c,A=d*o-l*r;f=Math.hypot(E,x,A),f==0?(E=0,x=0,A=0):(f=1/f,E*=f,x*=f,A*=f);let _=o*A-c*x,w=c*E-r*A,M=r*x-o*E;return f=Math.hypot(_,w,M),f==0?(_=0,w=0,M=0):(f=1/f,_*=f,w*=f,M*=f),new e(E,_,r,0,x,w,o,0,A,M,c,0,-(E*n+x*h+A*a),-(_*n+w*h+M*a),-(r*n+o*h+c*a),1)}constructor(t=1,s=0,i=0,n=0,h=0,a=1,r=0,o=0,c=0,f=0,d=1,l=0,u=0,E=0,x=0,A=1){this.a=t,this.b=s,this.c=i,this.d=n,this.e=h,this.f=a,this.g=r,this.h=o,this.i=c,this.j=f,this.k=d,this.l=l,this.m=u,this.n=E,this.o=x,this.p=A}get 0(){return this.a}get 1(){return this.b}get 2(){return this.c}get 3(){return this.d}get 4(){return this.e}get 5(){return this.f}get 6(){return this.g}get 7(){return this.h}get 8(){return this.i}get 9(){return this.j}get 10(){return this.k}get 11(){return this.l}get 12(){return this.m}get 13(){return this.n}get 14(){return this.o}get 15(){return this.p}get length(){return 16}toArray(t=null,s=0){return t===null&&(t=new Array(16)),t[s+0]=this.a,t[s+1]=this.b,t[s+2]=this.c,t[s+3]=this.d,t[s+4]=this.e,t[s+5]=this.f,t[s+6]=this.g,t[s+7]=this.h,t[s+8]=this.i,t[s+9]=this.j,t[s+10]=this.k,t[s+11]=this.l,t[s+12]=this.m,t[s+13]=this.n,t[s+14]=this.o,t[s+15]=this.p,t}toString(){return`Mat4 | ${this.a}, ${this.e}, ${this.i}, ${this.m} |
     | ${this.b}, ${this.f}, ${this.j}, ${this.n} |
     | ${this.c}, ${this.g}, ${this.k}, ${this.o} |
     | ${this.d}, ${this.h}, ${this.l}, ${this.p} |`}clone(){return new e(this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i,this.j,this.k,this.l,this.m,this.n,this.o,this.p)}copy(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this.g=t.g,this.h=t.h,this.i=t.i,this.j=t.j,this.k=t.k,this.l=t.l,this.m=t.m,this.n=t.n,this.o=t.o,this.p=t.p,this}decompose(t,s,i){let n=(this.a*this.f-this.b*this.e)*(this.k*this.p-this.l*this.o)-(this.a*this.g-this.c*this.e)*(this.j*this.p-this.l*this.n)+(this.a*this.h-this.d*this.e)*(this.j*this.o-this.k*this.n)+(this.b*this.g-this.c*this.f)*(this.i*this.p-this.l*this.m)-(this.b*this.h-this.d*this.f)*(this.i*this.o-this.k*this.m)+(this.c*this.h-this.d*this.g)*(this.i*this.n-this.j*this.m),h=Math.hypot(this.a,this.b,this.c)*Math.sign(n),a=Math.hypot(this.e,this.f,this.g),r=Math.hypot(this.i,this.j,this.k);t.x=this.m,t.y=this.n,t.z=this.o,this.a/=h,this.b/=h,this.c/=h,this.e/=a,this.f/=a,this.g/=a,this.i/=r,this.j/=r,this.k/=r;let o=this.a+this.f+this.k;if(o>0){let c=.5/Math.sqrt(o+1);s.x=(this.g-this.j)*c,s.y=(this.i-this.c)*c,s.z=(this.b-this.e)*c,s.w=.25/c}else if(this.a>this.f&&this.a>this.k){let c=2*Math.sqrt(1+this.a-this.f-this.k);s.x=.25*c,s.y=(this.e+this.b)/c,s.z=(this.i+this.c)/c,s.w=(this.g-this.j)/c}else if(this.f>this.k){let c=2*Math.sqrt(1+this.f-this.a-this.k);s.x=(this.e+this.b)/c,s.y=.25*c,s.z=(this.j+this.g)/c,s.w=(this.i-this.c)/c}else{let c=2*Math.sqrt(1+this.k-this.a-this.f);s.x=(this.i+this.c)/c,s.y=(this.j+this.g)/c,s.z=.25*c,s.w=(this.b-this.e)/c}i.x=h,i.y=a,i.z=r}equals(t,s=D){return Math.abs(this.a-t.a)<=s&&Math.abs(this.b-t.b)<=s&&Math.abs(this.c-t.c)<=s&&Math.abs(this.d-t.d)<=s&&Math.abs(this.e-t.e)<=s&&Math.abs(this.f-t.f)<=s&&Math.abs(this.g-t.g)<=s&&Math.abs(this.h-t.h)<=s&&Math.abs(this.i-t.i)<=s&&Math.abs(this.j-t.j)<=s&&Math.abs(this.k-t.k)<=s&&Math.abs(this.l-t.l)<=s&&Math.abs(this.m-t.m)<=s&&Math.abs(this.n-t.n)<=s&&Math.abs(this.o-t.o)<=s&&Math.abs(this.p-t.p)<=s}transpose(){return new e(this.a,this.e,this.i,this.m,this.b,this.f,this.j,this.n,this.c,this.g,this.k,this.o,this.d,this.h,this.l,this.p)}invert(){let t=this.a*this.f-this.b*this.e,s=this.a*this.g-this.c*this.e,i=this.a*this.h-this.d*this.e,n=this.b*this.g-this.c*this.f,h=this.b*this.h-this.d*this.f,a=this.c*this.h-this.d*this.g,r=this.i*this.n-this.j*this.m,o=this.i*this.o-this.k*this.m,c=this.i*this.p-this.l*this.m,f=this.j*this.o-this.k*this.n,d=this.j*this.p-this.l*this.n,l=this.k*this.p-this.l*this.o,u=t*l-s*d+i*f+n*c-h*o+a*r;return u?(u=1/u,new e((this.f*l-this.g*d+this.h*f)*u,(this.c*d-this.b*l-this.d*f)*u,(this.n*a-this.o*h+this.p*n)*u,(this.k*h-this.j*a-this.l*n)*u,(this.g*c-this.e*l-this.h*o)*u,(this.a*l-this.c*c+this.d*o)*u,(this.o*i-this.m*a-this.p*s)*u,(this.i*a-this.k*i+this.l*s)*u,(this.e*d-this.f*c+this.h*r)*u,(this.b*c-this.a*d-this.d*r)*u,(this.m*h-this.n*i+this.p*t)*u,(this.j*i-this.i*h-this.l*t)*u,(this.f*o-this.e*f-this.g*r)*u,(this.a*f-this.b*o+this.c*r)*u,(this.n*s-this.m*n-this.o*t)*u,(this.i*n-this.j*s+this.k*t)*u)):null}adjoint(){return new e(+(this.f*(this.k*this.p-this.l*this.o)-this.j*(this.g*this.p-this.h*this.o)+this.n*(this.g*this.l-this.h*this.k))-(this.b*(this.k*this.p-this.l*this.o)-this.j*(this.c*this.p-this.d*this.o)+this.n*(this.c*this.l-this.d*this.k))+(this.b*(this.g*this.p-this.h*this.o)-this.f*(this.c*this.p-this.d*this.o)+this.n*(this.c*this.h-this.d*this.g))-(this.b*(this.g*this.l-this.h*this.k)-this.f*(this.c*this.l-this.d*this.k)+this.j*(this.c*this.h-this.d*this.g))-(this.e*(this.k*this.p-this.l*this.o)-this.i*(this.g*this.p-this.h*this.o)+this.m*(this.g*this.l-this.h*this.k))+(this.a*(this.k*this.p-this.l*this.o)-this.i*(this.c*this.p-this.d*this.o)+this.m*(this.c*this.l-this.d*this.k))-(this.a*(this.g*this.p-this.h*this.o)-this.e*(this.c*this.p-this.d*this.o)+this.m*(this.c*this.h-this.d*this.g))+(this.a*(this.g*this.l-this.h*this.k)-this.e*(this.c*this.l-this.d*this.k)+this.i*(this.c*this.h-this.d*this.g))+(this.e*(this.j*this.p-this.l*this.n)-this.i*(this.f*this.p-this.h*this.n)+this.m*(this.f*this.l-this.h*this.j))-(this.a*(this.j*this.p-this.l*this.n)-this.i*(this.b*this.p-this.d*this.n)+this.m*(this.b*this.l-this.d*this.j))+(this.a*(this.f*this.p-this.h*this.n)-this.e*(this.b*this.p-this.d*this.n)+this.m*(this.b*this.h-this.d*this.f))-(this.a*(this.f*this.l-this.h*this.j)-this.e*(this.b*this.l-this.d*this.j)+this.i*(this.b*this.h-this.d*this.f))-(this.e*(this.j*this.o-this.k*this.n)-this.i*(this.f*this.o-this.g*this.n)+this.m*(this.f*this.k-this.g*this.j))+(this.a*(this.j*this.o-this.k*this.n)-this.i*(this.b*this.o-this.c*this.n)+this.m*(this.b*this.k-this.c*this.j))-(this.a*(this.f*this.o-this.g*this.n)-this.e*(this.b*this.o-this.c*this.n)+this.m*(this.b*this.g-this.c*this.f))+(this.a*(this.f*this.k-this.g*this.j)-this.e*(this.b*this.k-this.c*this.j)+this.i*(this.b*this.g-this.c*this.f)))}determinant(){return this.a*(this.f*(this.k*this.p-this.l*this.o)-this.g*(this.j*this.p-this.l*this.n)+this.h*(this.j*this.o-this.k*this.n))-this.b*(this.e*(this.k*this.p-this.l*this.o)-this.g*(this.i*this.p-this.l*this.m)+this.h*(this.i*this.o-this.k*this.m))+this.c*(this.e*(this.j*this.p-this.l*this.n)-this.f*(this.i*this.p-this.l*this.m)+this.h*(this.i*this.n-this.j*this.m))-this.d*(this.e*(this.j*this.o-this.k*this.n)-this.f*(this.i*this.o-this.k*this.m)+this.g*(this.i*this.n-this.j*this.m))}mul(t){return new e(t.a*this.a+t.b*this.e+t.c*this.i+t.d*this.m,t.a*this.b+t.b*this.f+t.c*this.j+t.d*this.n,t.a*this.c+t.b*this.g+t.c*this.k+t.d*this.o,t.a*this.d+t.b*this.h+t.c*this.l+t.d*this.p,t.e*this.a+t.f*this.e+t.g*this.i+t.h*this.m,t.e*this.b+t.f*this.f+t.g*this.j+t.h*this.n,t.e*this.c+t.f*this.g+t.g*this.k+t.h*this.o,t.e*this.d+t.f*this.h+t.g*this.l+t.h*this.p,t.i*this.a+t.j*this.e+t.k*this.i+t.l*this.m,t.i*this.b+t.j*this.f+t.k*this.j+t.l*this.n,t.i*this.c+t.j*this.g+t.k*this.k+t.l*this.o,t.i*this.d+t.j*this.h+t.k*this.l+t.l*this.p,t.m*this.a+t.n*this.e+t.o*this.i+t.p*this.m,t.m*this.b+t.n*this.f+t.o*this.j+t.p*this.n,t.m*this.c+t.n*this.g+t.o*this.k+t.p*this.o,t.m*this.d+t.n*this.h+t.o*this.l+t.p*this.p)}premul(t){return new e(this.a*t.a+this.b*t.e+this.c*t.i+this.d*t.m,this.a*t.b+this.b*t.f+this.c*t.j+this.d*t.n,this.a*t.c+this.b*t.g+this.c*t.k+this.d*t.o,this.a*t.d+this.b*t.h+this.c*t.l+this.d*t.p,this.e*t.a+this.f*t.e+this.g*t.i+this.h*t.m,this.e*t.b+this.f*t.f+this.g*t.j+this.h*t.n,this.e*t.c+this.f*t.g+this.g*t.k+this.h*t.o,this.e*t.d+this.f*t.h+this.g*t.l+this.h*t.p,this.i*t.a+this.j*t.e+this.k*t.i+this.l*t.m,this.i*t.b+this.j*t.f+this.k*t.j+this.l*t.n,this.i*t.c+this.j*t.g+this.k*t.k+this.l*t.o,this.i*t.d+this.j*t.h+this.k*t.l+this.l*t.p,this.m*t.a+this.n*t.e+this.o*t.i+this.p*t.m,this.m*t.b+this.n*t.f+this.o*t.j+this.p*t.n,this.m*t.c+this.n*t.g+this.o*t.k+this.p*t.o,this.m*t.d+this.n*t.h+this.o*t.l+this.p*t.p)}translate(t,s,i){let n;return typeof t=="number"?(n=t,s=s??0,i=i??0):(n=t.x,s=t.y,i=t.z),new e(this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i,this.j,this.k,this.l,this.m+this.a*n+this.e*s+this.i*i,this.n+this.b*n+this.f*s+this.j*i,this.o+this.c*n+this.g*s+this.k*i,this.p+this.d*n+this.h*s+this.l*i)}translateX(t){return new e(this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i,this.j,this.k,this.l,this.m+this.a*t,this.n+this.b*t,this.o+this.c*t,this.p+this.d*t)}translateY(t){return new e(this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i,this.j,this.k,this.l,this.m+this.e*t,this.n+this.f*t,this.o+this.g*t,this.p+this.h*t)}translateZ(t){return new e(this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i,this.j,this.k,this.l,this.m+this.i*t,this.n+this.j*t,this.o+this.k*t,this.p+this.l*t)}rotate(t,s){let i=t.x,n=t.y,h=t.z,a=Math.sin(s),r=Math.cos(s),o=1-r,c=i*i*o+r,f=n*i*o+h*a,d=h*i*o-n*a,l=i*n*o-h*a,u=n*n*o+r,E=h*n*o+i*a,x=i*h*o+n*a,A=n*h*o-i*a,_=h*h*o+r;return new e(this.a*c+this.e*f+this.i*d,this.b*c+this.f*f+this.j*d,this.c*c+this.g*f+this.k*d,this.d*c+this.h*f+this.l*d,this.a*l+this.e*u+this.i*E,this.b*l+this.f*u+this.j*E,this.c*l+this.g*u+this.k*E,this.d*l+this.h*u+this.l*E,this.a*x+this.e*A+this.i*_,this.b*x+this.f*A+this.j*_,this.c*x+this.g*A+this.k*_,this.d*x+this.h*A+this.l*_,this.m,this.n,this.o,this.p)}rotateX(t){let s=Math.sin(t),i=Math.cos(t);return new e(this.a,this.b,this.c,this.d,this.e*i+this.i*s,this.f*i+this.j*s,this.g*i+this.k*s,this.h*i+this.l*s,-this.e*s+this.i*i,-this.f*s+this.j*i,-this.g*s+this.k*i,-this.h*s+this.l*i,this.m,this.n,this.o,this.p)}rotateY(t){let s=Math.sin(t),i=Math.cos(t);return new e(this.a*i-this.i*s,this.b*i-this.j*s,this.c*i-this.k*s,this.d*i-this.l*s,this.e,this.f,this.g,this.h,this.a*s+this.i*i,this.b*s+this.j*i,this.c*s+this.k*i,this.d*s+this.l*i,this.m,this.n,this.o,this.p)}rotateZ(t){let s=Math.sin(t),i=Math.cos(t);return new e(this.a*i+this.e*s,this.b*i+this.f*s,this.c*i+this.g*s,this.d*i+this.h*s,-this.a*s+this.e*i,-this.b*s+this.f*i,-this.c*s+this.g*i,-this.d*s+this.h*i,this.i,this.j,this.k,this.l,this.m,this.n,this.o,this.p)}scale(t,s,i){let n;return typeof t=="number"?(n=t,s=s??t,i=i??t):(n=t.x,s=t.y,i=t.z),new e(this.a*n,this.b*n,this.c*n,this.d*n,this.e*s,this.f*s,this.g*s,this.h*s,this.i*i,this.j*i,this.k*i,this.l*i,this.m,this.n,this.o,this.p)}getTranslation(){return new U(this.m,this.n,this.o)}getMat3(){return new B(this.a,this.b,this.c,this.e,this.f,this.g,this.i,this.j,this.k)}getScaling(){return new U(Math.hypot(this.a,this.b,this.c),Math.hypot(this.e,this.f,this.g),Math.hypot(this.i,this.j,this.k))}*[Symbol.iterator](){yield this.a,yield this.b,yield this.c,yield this.d,yield this.e,yield this.f,yield this.g,yield this.h,yield this.i,yield this.j,yield this.k,yield this.l,yield this.m,yield this.n,yield this.o,yield this.p}};st.prototype.isMat4=!0;st.prototype.isMathPrimitive=!0;var G=class e{x;y;z;w;static zero(){return new e(0,0,0,0)}static of(t,s,i,n){return new e(t,s??t,i??t,n??t)}static xAxis(){return new e(1,0,0)}static yAxis(){return new e(0,1,0)}static zAxis(){return new e(0,0,1)}static translateX(t){return new e(t,0,0,1)}static translateY(t){return new e(0,t,0,1)}static translateZ(t){return new e(0,0,t,1)}static random(){return new e(Math.random(),Math.random(),Math.random(),Math.random())}static randomUnit(){let t,s,i,n=0;for(;t=Math.random()*2-1,s=Math.random()*2-1,i=Math.random()*2-1,n=Math.hypot(t,s,i),!(n>0););return new e(t/n,s/n,i/n,0)}static fromArray(t,s=0){if(t.length<s+4)throw new Error(`Cannot create a Vec4 at offset ${s} in array of length ${t.length}`);return new e(t[s],t[s+1],t[s+2],t[s+3])}constructor(t=0,s=0,i=0,n=1){this.x=t,this.y=s,this.z=i,this.w=n}get 0(){return this.x}set 0(t){this.x=t}get 1(){return this.y}set 1(t){this.y=t}get 2(){return this.z}set 2(t){this.z=t}get 3(){return this.w}set 3(t){this.w=t}get length(){return 4}get xyz(){return new U(this.x,this.y,this.z)}getIndex(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error(`Invalid Vec4 index: ${t}`)}}setIndex(t,s){switch(t){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;case 3:this.w=s;break;default:throw new Error(`Invalid Vec4 index: ${t}`)}}toArray(t=null,s=0){return t===null&&(t=new Array(4)),t[s]=this.x,t[s+1]=this.y,t[s+2]=this.z,t[s+3]=this.w,t}clone(){return new e(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}equals(t,s=D){return Math.abs(this.x-t.x)<=s&&Math.abs(this.y-t.y)<=s&&Math.abs(this.z-t.z)<=s&&Math.abs(this.w-t.w)<=s}any(){return this.x!=0||this.y!=0||this.z!=0||this.w!=0}set(t,s,i,n){return this.x=t,this.y=s??t,this.z=i??(s===void 0?t:0),this.w=n??1,this}add(t){return typeof t=="number"?new e(this.x+t,this.y+t,this.z+t,this.w+t):new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}sub(t){return typeof t=="number"?new e(this.x-t,this.y-t,this.z-t,this.w-t):new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}mul(t){return typeof t=="number"?new e(this.x*t,this.y*t,this.z*t,this.w*t):new e(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)}div(t){return typeof t=="number"?new e(this.x/t,this.y/t,this.z/t,this.w/t):new e(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)}negate(){return new e(-this.x,-this.y,-this.z,-this.w)}invert(){return new e(this.x==0?0:1/this.x,this.y==0?0:1/this.y,this.z==0?0:1/this.z,this.w==0?0:1/this.w)}mod(t){return typeof t=="number"?new e(this.x%t,this.y%t,this.z%t,this.w%t):new e(this.x%t.x,this.y%t.y,this.z%t.z,this.w%t.w)}lerp(t,s){return new e(this.x+(t.x-this.x)*s,this.y+(t.y-this.y)*s,this.z+(t.z-this.z)*s,this.w+(t.w-this.w)*s)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}magSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}magnitude(){return Math.hypot(this.x,this.y,this.z,this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.w!==0?new e(this.x/this.w,this.y/this.w,this.z/this.w,1):new e(this.x,this.y,this.z,this.w)}min(t){return typeof t=="number"?new e(Math.min(this.x,t),Math.min(this.y,t),Math.min(this.z,t),Math.min(this.w,t)):new e(Math.min(this.x,t.x),Math.min(this.y,t.y),Math.min(this.z,t.z),Math.min(this.w,t.w))}max(t){return typeof t=="number"?new e(Math.max(this.x,t),Math.max(this.y,t),Math.max(this.z,t),Math.max(this.w,t)):new e(Math.max(this.x,t.x),Math.max(this.y,t.y),Math.max(this.z,t.z),Math.max(this.w,t.w))}clamp(t,s){let i=typeof t=="number"?t:t.x,n=typeof s=="number"?s:s.x,h=typeof t=="number"?t:t.y,a=typeof s=="number"?s:s.y,r=typeof t=="number"?t:t.z,o=typeof s=="number"?s:s.z,c=typeof t=="number"?t:t.w,f=typeof s=="number"?s:s.w;return new e(Math.max(i,Math.min(n,this.x)),Math.max(h,Math.min(a,this.y)),Math.max(r,Math.min(o,this.z)),Math.max(c,Math.min(f,this.w)))}abs(){return new e(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z),Math.abs(this.w))}floor(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}ceil(){return new e(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z),Math.ceil(this.w))}round(){return new e(Math.round(this.x),Math.round(this.y),Math.round(this.z),Math.round(this.w))}trunc(){return new e(Math.trunc(this.x),Math.trunc(this.y),Math.trunc(this.z),Math.trunc(this.w))}applyMat4(t){let s=this.x,i=this.y,n=this.z,h=this.w;return new e(s*t.a+i*t.e+n*t.i+h*t.m,s*t.b+i*t.f+n*t.j+h*t.n,s*t.c+i*t.g+n*t.k+h*t.o,s*t.d+i*t.h+n*t.l+h*t.p)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};G.prototype.isVec4=!0;G.prototype.isMathPrimitive=!0;function Qe(e){return function(){var t=e+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}}function $t(e){return e.x*=e.x*34+133,e.y*=e.y*34+133,e.z*=e.z*34+133,e.w*=e.w*34+133,e}function _t(e){let t=new U(e,e/2,e/4).floor().mod(2).mul(2).sub(1),s=t.clone();s.setIndex(Math.max(0,Math.floor(e/16)),0);let i=Math.floor(e/8)%2,n=t.clone().mul(1-i).add(t.cross(s).add(s).mul(i)),h=s.mul(1.22474487139).add(n);return h.mul((1-.042942436724648037*i)*3.5946317686139184),h}function qt(e){let t=e.floor(),s=new G(e.x-t.x,e.y-t.y,e.z-t.z,2.5),i=t.add(Math.floor(s.dot(G.of(.25)))),n=t.add(U.xAxis()).add(new U(-1,1,1).mul(Math.floor(s.dot(new G(-.25,.25,.25,.35))))),h=t.add(U.yAxis()).add(new U(1,-1,1).mul(Math.floor(s.dot(new G(.25,-.25,.25,.35))))),a=t.add(U.zAxis()).add(new U(1,1,-1).mul(Math.floor(s.dot(new G(.25,.25,-.25,.35))))),r=$t(new G(i.x,n.x,h.x,a.x).mod(289));$t(r.add(new G(i.y,n.y,h.y,a.y)).mod(289)),$t(r.add(new G(i.z,n.z,h.z,a.z)).mod(289)).mod(48);let o=e.sub(i),c=e.sub(n),f=e.sub(h),d=e.sub(a),l=G.of(.75).sub(new G(o.dot(o),c.dot(c),f.dot(f),d.dot(d))).max(0),u=l.mul(l),E=u.mul(u),x=_t(r.x),A=_t(r.y),_=_t(r.z),w=_t(r.w),M=new G(o.dot(x),c.dot(A),f.dot(_),d.dot(w)),T=E.dot(M),N=u.mul(l).mul(M).applyMat4(st.fromVec3s(o,c,f,d)).mul(-8).add(E.applyMat4(st.fromVec3s(x,A,_,w)));return new G(N.x,N.y,N.z,T)}var Kt=new B(.788675134594813,-.211324865405187,-.577350269189626,-.211324865405187,.788675134594813,-.577350269189626,.577350269189626,.577350269189626,.577350269189626);function Ze(e){e.applyMat3(Kt);let t=qt(e.clone()).add(qt(e.add(144.5))),s=t.xyz.applyMat3(Kt);return new G(s.x,s.y,s.z,t.w)}var C=class e{x;y;z;w;static identity(){return new e(0,0,0,1)}static random(){let t=Math.random(),s=Math.random()*2*Math.PI,i=Math.random()*2*Math.PI,n=Math.sqrt(1-t),h=Math.sqrt(t);return new e(n*Math.cos(s),h*Math.sin(i),h*Math.cos(i),n*Math.sin(s))}static fromArray(t,s=0){if(t.length<s+4)throw new Error(`Cannot create a Quat at offset ${s} in array of length ${t.length}`);return new e(t[s],t[s+1],t[s+2],t[s+3])}static fromAxisAngle(t,s){let i=s/2,n=Math.sin(i);return new e(t.x*n,t.y*n,t.z*n,Math.cos(i))}static fromMat3(t){let s=t.a,i=t.d,n=t.g,h=t.b,a=t.e,r=t.h,o=t.c,c=t.f,f=t.i,d=s+a+f;if(d>0){let l=.5/Math.sqrt(d+1);return new e((c-r)*l,(n-o)*l,(h-i)*l,.25/l)}else if(s>a&&s>f){let l=2*Math.sqrt(1+s-a-f);return new e(.25*l,(i+h)/l,(n+o)/l,(c-r)/l)}else if(a>f){let l=2*Math.sqrt(1+a-s-f);return new e((i+h)/l,.25*l,(r+c)/l,(n-o)/l)}else{let l=2*Math.sqrt(1+f-s-a);return new e((n+o)/l,(r+c)/l,.25*l,(h-i)/l)}}static fromDirections(t,s){let i=t.dot(s)+1;if(i<D)if(Math.abs(t.x)>Math.abs(t.z)){let n=Math.hypot(t.x,t.y);return new e(-t.y/n,t.x/n,0,0)}else{let n=Math.hypot(t.y,t.z);return new e(0,-t.z/n,t.y/n,0)}else{let n=t.y*s.z-t.z*s.y,h=t.z*s.x-t.x*s.z,a=t.x*s.y-t.y*s.x,r=Math.hypot(n,h,a,i);return new e(n/r,h/r,a/r,i/r)}}static slerpOf(t,s,i){let n=t.x,h=t.y,a=t.z,r=t.w,o=s.x,c=s.y,f=s.z,d=s.w,l=n*o+h*c+a*f+r*d;l<0&&(l=-l,o=-o,c=-c,f=-f,d=-d);let u,E;if(1-l>D){let x=Math.acos(l),A=Math.sin(x);u=Math.sin((1-i)*x)/A,E=Math.sin(i*x)/A}else u=1-i,E=i;return new e(u*n+E*o,u*h+E*c,u*a+E*f,u*r+E*d)}static sqlerpOf(t,s,i,n,h){return e.slerpOf(e.slerpOf(t,s,h),e.slerpOf(i,n,h),2*h*(1-h))}constructor(t=0,s=0,i=0,n=1){this.x=t,this.y=s,this.z=i,this.w=n}get 0(){return this.x}get 1(){return this.y}get 2(){return this.x}get 3(){return this.w}get length(){return 4}toArray(t=null,s=0){return t===null&&(t=new Array(4)),t[s]=this.x,t[s+1]=this.y,t[s+2]=this.z,t[s+3]=this.w,t}clone(){return new e(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}equals(t,s=D){return Math.abs(this.x-t.x)<=s&&Math.abs(this.y-t.y)<=s&&Math.abs(this.z-t.z)<=s&&Math.abs(this.w-t.w)<=s}invert(){let t=this.x,s=this.y,i=this.z,n=this.w,h=t*t+s*s+i*i+n*n;return h===0?new e(0,0,0,1):(h=1/h,new e(-t*h,-s*h,-i*h,n*h))}conjugate(){return new e(-this.x,-this.y,-this.z,this.w)}magSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}magnitude(){return Math.hypot(this.x,this.y,this.z,this.w)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}normalize(){let t=Math.hypot(this.x,this.y,this.z,this.w);return t===0?new e(0,0,0,1):new e(this.x/t,this.y/t,this.z/t,this.w/t)}mul(t){let s=this.x,i=this.y,n=this.z,h=this.w,a=t.x,r=t.y,o=t.z,c=t.w;return new e(s*c+h*a+i*o-n*r,i*c+h*r+n*a-s*o,n*c+h*o+s*r-i*a,h*c-s*a-i*r-n*o)}angleTo(t){let s=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;return Math.acos(2*s*s-1)}getAxisAngle(t){let s=Math.acos(this.w)*2,i=Math.sin(s/2);return i>D?(t.x=this.x/i,t.y=this.y/i,t.z=this.z/i):(t.x=1,t.y=0,t.z=0),s}rotateX(t){t*=.5;let s=Math.sin(t),i=Math.cos(t),n=this.x,h=this.y,a=this.z,r=this.w;return new e(n*i+r*s,h*i+a*s,a*i-h*s,r*i-n*s)}rotateY(t){t*=.5;let s=Math.sin(t),i=Math.cos(t),n=this.x,h=this.y,a=this.z,r=this.w;return new e(n*i-a*s,h*i+r*s,a*i+n*s,r*i-h*s)}rotateZ(t){t*=.5;let s=Math.sin(t),i=Math.cos(t),n=this.x,h=this.y,a=this.z,r=this.w;return new e(n*i+h*s,h*i-n*s,a*i+r*s,r*i-a*s)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};C.prototype.isQuat=!0;C.prototype.isMathPrimitive=!0;var P=class e{x;y;static zero(){return new e(0,0)}static of(t,s){return new e(t,s??t)}static xAxis(){return new e(1,0)}static yAxis(){return new e(0,1)}static translateX(t){return new e(t,0)}static translateY(t){return new e(0,t)}static random(){return new e(Math.random(),Math.random())}static randomUnit(){let t,s,i=0;for(;t=Math.random()*2-1,s=Math.random()*2-1,i=Math.hypot(t,s),!(i>0););return new e(t/i,s/i)}static fromArray(t,s=0){if(t.length<s+2)throw new Error(`Cannot create a Vec2 at offset ${s} in array of length ${t.length}`);return new e(t[s],t[s+1])}constructor(t=0,s=0){this.x=t,this.y=s}get 0(){return this.x}set 0(t){this.x=t}get 1(){return this.y}set 1(t){this.y=t}get length(){return 2}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}get ratio(){return this.y===0?0:this.x/this.y}get u(){return this.x}set u(t){this.x=t}get v(){return this.y}set v(t){this.y=t}getIndex(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error(`Invalid Vec2 index: ${t}`)}}setIndex(t,s){switch(t){case 0:this.x=s;break;case 1:this.y=s;break;default:throw new Error(`Invalid Vec2 index: ${t}`)}}toArray(t=null,s=0){return t===null&&(t=new Array(2)),t[s]=this.x,t[s+1]=this.y,t}clone(){return new e(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}equals(t,s=D){return Math.abs(this.x-t.x)<=s&&Math.abs(this.y-t.y)<=s}any(){return this.x!=0||this.y!=0}set(t,s){return this.x=t,this.y=s??t,this}add(t){return typeof t=="number"?new e(this.x+t,this.y+t):new e(this.x+t.x,this.y+t.y)}sub(t){return typeof t=="number"?new e(this.x-t,this.y-t):new e(this.x-t.x,this.y-t.y)}mul(t){return typeof t=="number"?new e(this.x*t,this.y*t):new e(this.x*t.x,this.y*t.y)}div(t){return typeof t=="number"?new e(this.x/t,this.y/t):new e(this.x/t.x,this.y/t.y)}negate(){return new e(-this.x,-this.y)}invert(){return new e(this.x==0?0:1/this.x,this.y==0?0:1/this.y)}mod(t){return typeof t=="number"?new e(this.x%t,this.y%t):new e(this.x%t.x,this.y%t.y)}lerp(t,s){return new e(this.x+(t.x-this.x)*s,this.y+(t.y-this.y)*s)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}magSq(){return this.x*this.x+this.y*this.y}magnitude(){return Math.hypot(this.x,this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){let t=this.x*this.x+this.y*this.y;if(t>0){let s=1/Math.sqrt(t);return new e(this.x*s,this.y*s)}return new e(0,0)}distanceTo(t){return Math.hypot(this.x-t.x,this.y-t.y)}distanceToSq(t){let s=this.x-t.x,i=this.y-t.y;return s*s+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}min(t){return typeof t=="number"?new e(Math.min(this.x,t),Math.min(this.y,t)):new e(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return typeof t=="number"?new e(Math.max(this.x,t),Math.max(this.y,t)):new e(Math.max(this.x,t.x),Math.max(this.y,t.y))}clamp(t,s){let i=typeof t=="number"?t:t.x,n=typeof t=="number"?t:t.y,h=typeof s=="number"?s:s.x,a=typeof s=="number"?s:s.y;return new e(Math.max(i,Math.min(h,this.x)),Math.max(n,Math.min(a,this.y)))}clampMagnitude(t,s){let i=this.x*this.x+this.y*this.y;if(i>0){let n=Math.sqrt(i),h=Math.max(t,Math.min(s,n))/n;return new e(this.x*h,this.y*h)}return new e(0,0)}abs(){return new e(Math.abs(this.x),Math.abs(this.y))}floor(){return new e(Math.floor(this.x),Math.floor(this.y))}ceil(){return new e(Math.ceil(this.x),Math.ceil(this.y))}round(){return new e(Math.round(this.x),Math.round(this.y))}trunc(){return new e(Math.trunc(this.x),Math.trunc(this.y))}angle(){return Math.atan2(this.y,this.x)}angleTo(t){return Math.atan2(this.x*t.y-this.y*t.x,this.x*t.x+this.y*t.y)}translateX(t){return new e(this.x+t,this.y)}translateY(t){return new e(this.x,this.y+t)}rotate(t){let s=Math.cos(t),i=Math.sin(t);return new e(this.x*s-this.y*i,this.x*i+this.y*s)}rotateAround(t,s){let i=Math.cos(t),n=Math.sin(t),h=this.x-s.x,a=this.y-s.y;return new e(h*i-a*n+s.x,h*n+a*i+s.y)}applyMat3(t){let s=this.x,i=this.y;return new e(s*t.a+i*t.d+t.g,s*t.b+i*t.e+t.h)}*[Symbol.iterator](){yield this.x,yield this.y}};P.prototype.isVec2=!0;P.prototype.isMathPrimitive=!0;var ft=class e{x;y;width;height;static unionOf(t){if(t.length===0)return new e;let s=t[0].clone();for(let i=1;i<t.length;i++)s.union(t[i]);return s}static fromCorners(t,s){return new e(Math.min(t.x,s.x),Math.min(t.y,s.y),Math.abs(t.x-s.x),Math.abs(t.y-s.y))}constructor(t=0,s=0,i=0,n=0){this.x=t,this.y=s,this.width=i,this.height=n}clone(){return new e(this.x,this.y,this.width,this.height)}copy(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}set(t,s,i,n){return this.x=t,this.y=s,this.width=i,this.height=n,this}get size(){return new P(this.width,this.height)}set size(t){this.width=t.x,this.height=t.y}get left(){return this.x}set left(t){this.x=t}get top(){return this.y}set top(t){this.y=t}get right(){return this.x+this.width}set right(t){this.width=Math.max(0,t-this.x)}get bottom(){return this.y+this.height}set bottom(t){this.height=Math.max(0,t-this.y)}get topLeft(){return new P(this.x,this.y)}get topRight(){return new P(this.x+this.width,this.y)}get bottomLeft(){return new P(this.x,this.y+this.height)}get bottomRight(){return new P(this.x+this.width,this.y+this.height)}get center(){return new P(this.x+this.width*.5,this.y+this.height*.5)}contains(t,s){return t>=this.x&&t<=this.x+this.width&&s>=this.y&&s<=this.y+this.height}containsRect(t){return t.x>=this.x&&t.y>=this.y&&t.right<=this.right&&t.bottom<=this.bottom}intersects(t){return this.x<t.right&&this.right>t.x&&this.y<t.bottom&&this.bottom>t.y}intersects4(t,s,i,n){return this.x<t+i&&this.right>t&&this.y<s+n&&this.bottom>s}union(t){let s=Math.min(this.x,t.x),i=Math.min(this.y,t.y);return new e(s,i,Math.max(this.right,t.right)-s,Math.max(this.bottom,t.bottom)-i)}isEmpty(){return this.width<=0||this.height<=0}clear(){this.x=this.y=this.width=this.height=0}include(t,s){return t<this.x?(this.width+=this.x-t,this.x=t):t>this.right&&(this.width=t-this.x),s<this.y?(this.height+=this.y-s,this.y=s):s>this.bottom&&(this.height=s-this.y),this}grow(t){return this.x-=t,this.y-=t,this.width+=t*2,this.height+=t*2,this}};ft.prototype.isRect=!0;ft.prototype.isMathPrimitive=!0;function Je(e,t={}){let s=Math.abs(t.width??1),i=Math.abs(t.height??1),n=Math.max(Math.round(t.widthSegments??1),1),h=Math.max(Math.round(t.heightSegments??1),1),a=t.textureXform??B.identity(),r=new Array,o=new Array,c=new Array,f=new Array,d=new Array,l=new P;for(let u=0;u<=h;u++){let E=u/h;for(let x=0;x<=n;x++){let A=x/n;if(r.push((2*A-1)*s,(2*E-1)*i,0),x<n&&u<h){let _=(n+1)*(u+0)+(x+0),w=(n+1)*(u+0)+(x+1),M=(n+1)*(u+1)+(x+1),T=(n+1)*(u+1)+(x+0);o.push(_,w,T,w,M,T)}f.push(0,0,1),d.push(1,0,0),l.x=A,l.y=E,l.applyMat3(a),c.push(l.x,l.y)}}return{name:e,positions:r,indices:o,texCoords:c,normals:f,tangents:d}}function ts(e,t={}){let s=Math.abs(t.radius??1),i=Math.max(Math.round(t.segments??32),3),n=Math.max(Math.round(t.internalSegments??1),1),h=new Array,a=new Array,r=new Array,o=new Array,c=new Array;for(let f=0;f<=n;f++){let d=s*(f/n);for(let l=0;l<=i;l++){let u=2*Math.PI*(l/i),E=-d*Math.cos(u),x=d*Math.sin(u);if(h.push(E,x,0),o.push(0,0,1),c.push(1,0,0),r.push((E/s+1)/2,(x/s+1)/2),f<n&&l<i){let A=f*(i+1)+l,_=f*(i+1)+l+1,w=(f+1)*(i+1)+l+1,M=(f+1)*(i+1)+l;a.push(A,_,M),a.push(_,w,M)}}}return{name:e,positions:h,indices:a,texCoords:r,normals:o,tangents:c}}function es(e,t={}){let s=t.width??1,i=t.height??1,n=t.depth??1,h=Math.max(1,Math.round(t.widthSegments??1)),a=Math.max(1,Math.round(t.heightSegments??1)),r=Math.max(1,Math.round(t.depthSegments??1)),o=t.textureXform??B.identity(),c=new Array,f=new Array,d=new Array,l=new Array,u=new Array;function E(x,A,_,w,M,T){let N=x/2,p=A/2,X=_/2,j=x/w,k=A/M,v=c.length/3,H=w+1,it=new U(0,0,1).rotateQuat(T),yt=new U(1,0,0).rotateQuat(T);for(let Q=0;Q<=M;Q++){let Jt=Q*k-p;for(let Z=0;Z<=w;Z++){let wt=new U(Z*j-N,Jt,X).rotateQuat(T);c.push(wt.x,wt.y,wt.z);let zt=new P(Z/w,Q/M).applyMat3(o);if(d.push(zt.x,zt.y),l.push(it.x,it.y,it.z),u.push(yt.x,yt.y,yt.z),Q<M&&Z<w){let te=v+Z+H*Q,Gt=v+Z+H*(Q+1),ee=v+(Z+1)+H*(Q+1),Dt=v+(Z+1)+H*Q;f.push(te,Dt,Gt),f.push(Gt,Dt,ee)}}}}return E(n,i,s,r,a,C.fromAxisAngle(new U(0,1,0),Math.PI/-2)),E(n,i,s,r,a,C.fromAxisAngle(new U(0,1,0),Math.PI/2)),E(s,n,i,h,r,C.fromAxisAngle(new U(1,0,0),Math.PI/2)),E(s,n,i,h,r,C.fromAxisAngle(new U(1,0,0),Math.PI/-2)),E(s,i,n,h,a,C.fromAxisAngle(new U(0,1,0),Math.PI)),E(s,i,n,h,a,C.fromAxisAngle(new U(0,1,0),0)),{name:e,positions:c,indices:f,texCoords:d,normals:l,tangents:u}}function ss(e,t={}){let s=Math.max(0,t.radius??1),i=Math.max(3,Math.floor(t.widthSegments??32)),n=Math.max(2,Math.floor(t.heightSegments??16)),h=t.textureXform??B.identity(),a=new Array,r=new Array,o=new Array,c=new Array,f=new P;for(let d=0;d<=n;d++){let l=d*Math.PI/n,u=Math.sin(l),E=Math.cos(l),x=0;d===0?x=.5/i:d===n&&(x=-.5/i);for(let A=0;A<=i;A++){let _=A*2*Math.PI/i,w=Math.cos(_)*u,M=E,T=Math.sin(_)*u;if(f.x=1-A/i+x,f.y=1-d/n,f.applyMat3(h),a.push(s*w,s*M,s*T),c.push(w,M,T),o.push(f.x,f.y),d<n&&A<i){let N=d*(i+1)+A,p=N+i+1;r.push(N,N+1,p),r.push(p,N+1,p+1)}}}return Qt(e,r,a,o,c),{name:e,positions:a,indices:r,texCoords:o,normals:c,tangents:Ot(a,o,r,c)}}function is(e,t={}){let s=t.in2D??!0,i=t.left??-1,n=t.right??1,h=t.top??1,a=t.bottom??-1;return{name:e,positions:s?[i,a,i,h,n,h,n,a]:[i,a,0,i,h,0,n,h,0,n,a,0],indices:[0,1,2,0,2,3],texCoords:[0,0,0,1,1,1,1,0],normals:s?[]:[0,0,1,0,0,1,0,0,1,0,0,1],tangents:s?[]:[1,0,0,1,0,0,1,0,0,1,0,0]}}function ns(e,t={}){let s=Math.max(0,t.knotRadius??1),i=Math.max(0,t.tubeRadius??.4),n=Math.max(3,Math.floor(t.tubeSegments??64)),h=Math.max(3,Math.floor(t.radialSegments??8)),a=Math.max(1,Math.floor(t.p??2)),r=Math.max(1,Math.floor(t.q??3)),o=[],c=[],f=[],d=[],l=(w,M,T,N,p)=>{let X=Math.cos(w),j=Math.sin(w),k=T/M*w,v=Math.cos(k);p.x=N*(2+v)*.5*X,p.y=N*(2+v)*j*.5,p.z=N*Math.sin(k)*.5},u=new U,E=new U,x=new U,A=new U,_=new U;for(let w=0;w<=n;++w){let M=w/n*a*Math.PI*2;l(M,a,r,s,E),l(M+.01,a,r,s,_),A=_.sub(E),x=A.cross(_),_=x.cross(A),x=x.normalize(),_=_.normalize();for(let T=0;T<=h;++T){let N=T/h*Math.PI*2,p=-i*Math.cos(N),X=i*Math.sin(N);if(u.x=E.x+(p*_.x+X*x.x),u.y=E.y+(p*_.y+X*x.y),u.z=E.z+(p*_.z+X*x.z),o.push(u.x,u.y,u.z),u=u.sub(E).normalize(),f.push(u.x,u.y,u.z),d.push(w/n),d.push(T/h),w>=1&&T>=1){let j=(h+1)*(w-1)+(T-1),k=(h+1)*w+(T-1),v=(h+1)*w+T,H=(h+1)*(w-1)+T;c.push(j,k,H,k,v,H)}}}return{name:e,positions:o,indices:c,texCoords:d,normals:f,tangents:Ot(o,d,c,f)}}function hs(e){let t=new Set(["#","mtllib","usemtl","g","l","s",""]),s,i=[],n=[],h=[],a=[],r=e.split(`
`);for(let[o,c]of r.entries()){let f=c.split(" "),d=f[0];if(!t.has(d))if(d==="o")s===void 0?s=f[1]:b(()=>`Multiple object names defined in OBJ file (on line ${o})`);else if(d==="v")i.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));else if(d==="vn")h.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));else if(d==="vt")a.push(parseFloat(f[1]),parseFloat(f[2]));else if(d==="f")for(let l=1;l<=3;l++){let u=f[l].split("/"),E=parseInt(u[0])-1,x=u.length>1&&u[1]!==""?parseInt(u[1])-1:E,A=u.length>2?parseInt(u[2])-1:E;n.push([E,x,A])}else I(()=>`Unexpected OBJ token: "${d}" on line ${o}`)}return s===void 0&&b(()=>`No object name defined in OBJ file: "${e}"`),h.length===0&&(console.log(`Calculating normals for object "${s}"`),h.push(...us(i,n.map(o=>o[2])))),a.length===0&&(I(()=>`No texture coordinates defined for object "${s}"`),a.push(...new Array(i.length/3*2).fill(0))),{name:s,positions:i,texCoords:a,normals:h,splitIndices:n}}function as(e,t){let s=t.positions,i=t.texCoords,n=t.normals,h=t.indices,a=0,r=new Map;for(let o of e.splitIndices){let c=o.join("|"),f=r.get(c);if(f!==void 0){h.push(f);continue}let[d,l,u]=o,E=d*3;s.push(...e.positions.slice(E,E+3));let x=l*2;i.push(...e.texCoords.slice(x,x+2));let A=u*3;n.push(...e.normals.slice(A,A+3)),h.push(a),r.set(c,a),a++}t.tangents=Ot(s,i,h,n)}async function rs(e){let s=await(await fetch(e,{mode:"cors",method:"GET",headers:{"Content-Type":"text/plain"}})).text(),i=hs(s),n={name:i.name,positions:[],indices:[],texCoords:[],normals:[],tangents:[]};return as(i,n),n.name,n.indices,n.positions,Qt(n.name,n.indices,n.positions,n.texCoords,n.normals,n.tangents),n}function cs(e){let t=new Set,s=e.indices.length,i=e.positions.length/3,n=i;for(let h=0;h<s;h++){let a=e.indices[h];t.has(a)?(e.indices[h]=n,t.add(n++),e.positions.push(e.positions[a*3],e.positions[a*3+1],e.positions[a*3+2]),e.texCoords.push(e.texCoords[a*2],e.texCoords[a*2+1]),e.normals.push(e.normals[a*3],e.normals[a*3+1],e.normals[a*3+2]),e.tangents.push(e.tangents[a*3],e.tangents[a*3+1],e.tangents[a*3+2])):t.add(a)}i!==n&&z(()=>`Uniquified ${n-i} vertices.`)}function os(e){new Set(e.indices).size!==e.indices.length&&b(()=>`The geometry "${e.name}" must have unique vertices to generate barycentric coordinates.`);let t=new Array(e.positions.length).fill(0),s=e.indices;for(let i=0;i<e.indices.length;i+=3)t[s[i]*3]=1,t[s[i+1]*3+1]=1,t[s[i+2]*3+2]=1;return S(t.length===e.positions.length,()=>`Failed to calculate barycentric coordinates for geometry "${e.name}"`),t}function Qt(e,t,s,i,n,h){s.length%3!==0&&b(()=>`The positions array of "${e}" must have a length that is a multiple of 3, but it is ${s.length}.`),t.length%3!==0&&b(()=>`The indices array of "${e}" must have a length that is a multiple of 3, but it is ${t.length}.`),i&&i.length%2!==0&&b(()=>`The UVs array of "${e}" must have a length that is a multiple of 2, but it is ${i.length}.`),n&&n.length%3!==0&&b(()=>`The normals array of "${e}" must have a length that is a multiple of 3, but it is ${n.length}.`),h&&h.length%3!==0&&b(()=>`The tangents array of "${e}" must have a length that is a multiple of 3, but it is ${h.length}.`);let a=s.length/3;i&&i.length/2!==a&&b(()=>`The UVs array of "${e}" must have the same number of elements as the positions array.`),n&&n.length!==s.length&&b(()=>`The normals array of "${e}" must have the same number of elements as the positions array.`),h&&h.length!==s.length&&b(()=>`The tangents array of "${e}" must have the same number of elements as the positions array.`);let r=new Set;for(let f of t)r.add(f);if(r.size===a)return;let o=new Array;for(let f=0;f<a;f++)r.has(f)||o.push(f);for(let f=o.length-1;f>=0;f--){let d=o[f];s.splice(d*3,3),i&&i.splice(d*2,2),n&&n.splice(d*3,3),h&&h.splice(d*3,3)}let c=[];{let f=0,d=o[0],l=1;for(let u=0;u<a;u++)u===d&&(f++,d=o[l++]),c.push(f)}for(let f=0;f<t.length;f++)t[f]-=c[t[f]];z(()=>`Removed ${o.length} unused vertices from "${e}".`)}function us(e,t){if(e.length===0||t.length===0)return I(()=>"Skipping computation of normals for an empty mesh."),[];t.length%3!==0&&b(()=>"The indices array must be a multiple of 3."),e.length%3!==0&&b(()=>"The positions array must be a multiple of 3.");let s=new Array(e.length).fill(0);for(let i=0;i<t.length;i+=3){let n=t[i]*3,h=t[i+1]*3,a=t[i+2]*3,r=e[n],o=e[n+1],c=e[n+2],f=e[h]-r,d=e[h+1]-o,l=e[h+2]-c,u=e[a]-r,E=e[a+1]-o,x=e[a+2]-c,A=d*x-l*E,_=l*u-f*x,w=f*E-d*u;s[n]+=A,s[n+1]+=_,s[n+2]+=w,s[h]+=A,s[h+1]+=_,s[h+2]+=w,s[a]+=A,s[a+1]+=_,s[a+2]+=w}for(let i=0;i<s.length;i+=3){let n=Math.hypot(s[i],s[i+1],s[i+2]);if(n===0){I(()=>`Cannot generate normal for vertex ${i/3} because it is not part of a face.`);continue}s[i]/=n,s[i+1]/=n,s[i+2]/=n}return s}function Ot(e,t,s,i){if(e.length===0||t.length===0||s.length===0)return I(()=>"Skipping computation of tangents for an empty mesh."),[];s.length%3!==0&&b(()=>"The indices array must be a multiple of 3."),e.length%3!==0&&b(()=>"The positions array must be a multiple of 3."),t.length%2!==0&&b(()=>"The UVs array must be a multiple of 2."),i&&i.length%3!==0&&b(()=>"The normals array must be a multiple of 3.");let n=e.length/3;t.length/2!==n&&b(()=>"The UVs array must have the same number of elements as the positions array."),i&&i.length!==e.length&&b(()=>"The normals array must have the same number of elements as the positions array.");let h=Array(e.length).fill(0);for(let a=0;a<s.length;a+=3){let r=s[a],o=s[a+1],c=s[a+2],f=e[r*3],d=e[r*3+1],l=e[r*3+2],u=e[o*3]-f,E=e[o*3+1]-d,x=e[o*3+2]-l,A=e[c*3]-f,_=e[c*3+1]-d,w=e[c*3+2]-l,M=t[r*2],T=t[r*2+1],N=t[o*2]-M,p=t[o*2+1]-T,X=t[c*2]-M,j=t[c*2+1]-T,k=1/(N*j-X*p),v=(j*u-p*A)*k,H=(j*E-p*_)*k,it=(j*x-p*w)*k;h[r*3]+=v,h[r*3+1]+=H,h[r*3+2]+=it,h[o*3]+=v,h[o*3+1]+=H,h[o*3+2]+=it,h[c*3]+=v,h[c*3+1]+=H,h[c*3+2]+=it}if(i)for(let a=0;a<h.length;a+=3){let r=h[a],o=h[a+1],c=h[a+2],f=i[a],d=i[a+1],l=i[a+2],u=f*r+d*o+l*c;r-=u*f,o-=u*d,c-=u*l;let E=Math.hypot(r,o,c);E!==0&&(h[a]=r/E,h[a+1]=o/E,h[a+2]=c/E)}else for(let a=0;a<h.length;a+=3){let r=Math.hypot(h[a],h[a+1],h[a+2]);r!==0&&(h[a]/=r,h[a+1]/=r,h[a+2]/=r)}return h}function fs(e){if(e.ctx===void 0&&(e.width===void 0||e.height===void 0))throw new Error("Either ctx or width and height must be provided.");let t=e.width??e.ctx.canvas.width,s=e.height??e.ctx.canvas.height;return et(e.gl,e.name,t,s,{useAnisotropy:!0,internalFormat:y.RGBA8})}function ls(e,t={}){let s=t.gridSize??10,i=t.axisWidth??2,n=t.gridWidth??1,h=t.axisColorX??"rgb(255, 255, 255)",a=t.axisColorY??"rgb(255, 255, 255)",r=t.gridColor??"rgb(255, 255, 255)",o=t.axisAlpha??1,c=t.gridAlpha??.9;if(s%2!=0)throw new Error(`Grid Size must be an even number, got ${s}`);let f=e.canvas.width,d=e.canvas.height,l=Math.max(i,n),u=(f-l*2)/s;e.lineWidth=n,e.lineCap="round",e.globalAlpha=1,e.strokeStyle=r;for(let x=0;x<=s;x++){let A=l+x*u;e.beginPath(),e.moveTo(A,l),e.lineTo(A,d-l),e.stroke(),e.beginPath(),e.moveTo(l,A),e.lineTo(f-l,A),e.stroke()}if(c<1){var E=e.getImageData(0,0,e.canvas.width,e.canvas.height);let x=E.data;for(let A=0;A<x.length;A+=4)x[A+3]*=c;e.putImageData(E,0,0)}e.lineWidth=i,e.globalAlpha=o,e.strokeStyle=h,e.beginPath(),e.moveTo(l,d/2),e.lineTo(f-l,d/2),e.stroke(),e.strokeStyle=a,e.beginPath(),e.moveTo(f/2,l),e.lineTo(f/2,d-l),e.stroke(),e.globalAlpha=1}function Es(e,t,s){try{e.bindTexture(e.TEXTURE_2D,s.glo),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,t.canvas),e.generateMipmap(e.TEXTURE_2D)}finally{e.bindTexture(e.TEXTURE_2D,null)}}function Zt(e,t){return Array.from({length:t},()=>e).flat()}function ds(e,t,s){return e.slice(t,t+s)}function xs(e,t=1){if(e.length===0)return[];if(e.length===1)return e[0];Array.isArray(t)?t.length!==e.length&&b(()=>`'quantities' must be either a number or an array with the same length as 'arrays'.
    'quantities' length: ${t.length}
    'arrays' length: ${e.length}`):t=Zt([t],e.length);let s=e[0].length/t[0];for(let n=0;n<e.length;n++){let h=t[n];h<1&&b(()=>`'quantity' must be greater than 0, but the value at index ${n} is ${h}`),h%1!==0&&b(()=>`'quantity' must be an integer, but the value at index ${n} is ${h}`),e[n].length%h!==0&&b(()=>`The length of the corresponding array must be a multiple of 'quantity'
    but the quantity at index ${n} is ${h}
    whereas the length of the corresponding array is ${e[n].length}`),e[n].length/h!==s&&b(()=>`All arrays must have the same number of quantities,
    but array ${n} of size ${e[n].length} contains ${e[n].length/h} times ${h} quantities,
    whereas the first array conttains ${e[0].length/h} times ${t[0]} quantities.`)}let i=[];for(let n=0;n<s;n++)for(let h=0;h<e.length;h++){let a=e[h],r=t[h];i.push(...a.slice(n*r,(n+1)*r))}return i}async function bs(e){try{return await(await fetch(e)).text()}catch(t){throw new Error(`Failed to load code snippet from ${e}: ${t}`)}}return re(As);})();
/// @license MIT
